--DELETE FROM LANDING.WORK_CS_MEMBERSHIP_CUSTOMER_DIM_MD5 WHERE TRUE;
INSERT INTO LANDING.WORK_CS_MEMBERSHIP_CUSTOMER_DIM_MD5
(
MBR_KY,
MBRS_ID,
ASSOCIATE_ID,
CARD_NAME,
BIRTH_DT,
MBR_MID_INIT_NM,
MBR_FST_NM,
MBR_LST_NM,
MBR_NM_SUFX_CD,
MBR_GNDR_CD,
DECEASED_IND,
MBRS_KY,
MBR_SLTN_CD,
BILLING_ADDRESS_LINE1,
BILLING_ADDRESS_LINE2,
BILLING_CITY,
BILLING_STATE,
BILLING_ZIP,
BILLING_ZIP_PLUS4,
BILLING_ADDRESS_START_DT,
BILLING_ADDRESS_END_DT,
RESIDENTIAL_ADDRESS_LINE1,
RESIDENTIAL_ADDRESS_LINE2,
RESIDENTIAL_CITY,
RESIDENTIAL_STATE,
RESIDENTIAL_ZIP,
RESIDENTIAL_ZIP_PLUS4,
RESIDENTIAL_ADDRESS_START_DT,
RESIDENTIAL_ADDRESS_END_DT,
TEMPORARY_ADDRESS_LINE1,
TEMPORARY_ADDRESS_LINE2,
TEMPORARY_CITY,
TEMPORARY_STATE,
TEMPORARY_ZIP,
TEMPORARY_ZIP_PLUS4,
TEMPORARY_ADDRESS_START_DT,
TEMPORARY_ADDRESS_END_DT,
EMAIL_ADDRESS,
EMAIL_UPDATE_DT,
HOME_PHONE_NUM,
WORK_PHONE_NUM,
MOBILE_PHONE_NUM,
CUSTOMERID,
MARITALSTATUS,
MBRS_UPDATE_DT,
MD5_VALUE
)
SELECT * EXCEPT(RN) FROM (
SELECT DISTINCT 
MEMBER_KEY AS MBR_KY,
MEMBER_NUM AS MBRS_ID,
ASSOCIATE_ID,
MBR_CARD_NAME,
MBR_BRTH_DT,
MBR_MID_INIT_NM,
MBR_FST_NM,
MBR_LST_NM,
MBR_NM_SUFX_CD,
MBR_GNDR_CD,
DECEASED_IND,
MBRS_KY,
MBR_SLTN_CD,
BILLING_ADDRESS_LINE1,
BILLING_ADDRESS_LINE2,
BILLING_CITY,
BILLING_STATE,
BILLING_ZIP,
BILLING_ZIP_PLUS4,
BILLING_ADDRESS_START_DT,
BILLING_ADDRESS_END_DT,
RESIDENTIAL_ADDRESS_LINE1,
RESIDENTIAL_ADDRESS_LINE2,
RESIDENTIAL_CITY,
RESIDENTIAL_STATE,
RESIDENTIAL_ZIP,
RESIDENTIAL_ZIP_PLUS4,
RESIDENTIAL_ADDRESS_START_DT,
RESIDENTIAL_ADDRESS_END_DT,
TEMPORARY_ADDRESS_LINE1,
TEMPORARY_ADDRESS_LINE2,
TEMPORARY_CITY,
TEMPORARY_STATE,
TEMPORARY_ZIP,
TEMPORARY_ZIP_PLUS4,
TEMPORARY_ADDRESS_START_DT,
TEMPORARY_ADDRESS_END_DT,
EMAIL_ADDRESS,
EMAIL_UPDATE_DT,
HOME_PHONE_NUM,
WORK_PHONE_NUM,
MOBILE_PHONE_NUM,
CUSTOMERID,
MARITALSTATUS,
MBRS_UPDATE_DT,
MD5(CONCAT(
COALESCE(CAST(MBR_CARD_NAME AS STRING),' '),
COALESCE(CAST( MBR_BRTH_DT AS STRING),' '),
COALESCE(CAST(MBR_MID_INIT_NM AS STRING),' '),
COALESCE(CAST(MBR_FST_NM AS STRING),' '),
COALESCE(CAST(MBR_LST_NM AS STRING),' '),
COALESCE(CAST(MBR_NM_SUFX_CD AS STRING),' '),
COALESCE(CAST(MBR_GNDR_CD AS STRING),' '),
COALESCE(CAST(DECEASED_IND AS STRING),' '),
COALESCE(CAST(MBRS_KY AS STRING),' '),
COALESCE(CAST(MBR_SLTN_CD AS STRING),' '),
COALESCE(CAST(BILLING_ADDRESS_LINE1 AS STRING),' '),
COALESCE(CAST(BILLING_ADDRESS_LINE2 AS STRING),' '),
COALESCE(CAST(BILLING_CITY AS STRING),' '),
COALESCE(CAST(BILLING_STATE AS STRING),' '),
COALESCE(CAST(BILLING_ZIP AS STRING),' '),
COALESCE(CAST(BILLING_ZIP_PLUS4 AS STRING),' '),
COALESCE(CAST(BILLING_ADDRESS_START_DT AS STRING),' '),
COALESCE(CAST(BILLING_ADDRESS_END_DT AS STRING),' '),
COALESCE(CAST(RESIDENTIAL_ADDRESS_LINE1 AS STRING),' '),
COALESCE(CAST(RESIDENTIAL_ADDRESS_LINE2 AS STRING),' '),
COALESCE(CAST(RESIDENTIAL_CITY AS STRING),' '),
COALESCE(CAST(RESIDENTIAL_STATE AS STRING),' '),
COALESCE(CAST(RESIDENTIAL_ZIP AS STRING),' '),
COALESCE(CAST(RESIDENTIAL_ZIP_PLUS4 AS STRING),' '),
COALESCE(CAST(RESIDENTIAL_ADDRESS_START_DT AS STRING),' '),
COALESCE(CAST(RESIDENTIAL_ADDRESS_END_DT AS STRING),' '),
COALESCE(CAST(TEMPORARY_ADDRESS_LINE1 AS STRING),' '),
COALESCE(CAST(TEMPORARY_ADDRESS_LINE2 AS STRING),' '),
COALESCE(CAST(TEMPORARY_CITY AS STRING),' '),
COALESCE(CAST(TEMPORARY_STATE AS STRING),' '),
COALESCE(CAST(TEMPORARY_ZIP AS STRING),' '),
COALESCE(CAST(TEMPORARY_ZIP_PLUS4 AS STRING),' '),
COALESCE(CAST(TEMPORARY_ADDRESS_START_DT AS STRING),' '),
COALESCE(CAST(TEMPORARY_ADDRESS_END_DT AS STRING),' '),
COALESCE(CAST(EMAIL_ADDRESS AS STRING),' '),
COALESCE(CAST(EMAIL_UPDATE_DT AS STRING),' '),
COALESCE(CAST(HOME_PHONE_NUM AS STRING),' '),
COALESCE(CAST(WORK_PHONE_NUM AS STRING),' '),
COALESCE(CAST(MOBILE_PHONE_NUM AS STRING),' '),
COALESCE(CAST(CUSTOMERID AS STRING),' '),
COALESCE(CAST(MARITALSTATUS AS STRING),' ')
)),
ROW_NUMBER() OVER(PARTITION BY CONCAT(MEMBER_NUM,ASSOCIATE_ID) ORDER BY MBRS_UPDATE_DT DESC) RN
FROM LANDING.WORK_CS_MEMBERSHIP_CUSTOMER_DIM) WHERE RN =1;
