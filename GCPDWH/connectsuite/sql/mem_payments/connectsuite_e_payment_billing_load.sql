MERGE INTO OPERATIONAL.CONNECTSUITE_E_PAYMENT_BILLING M
USING LANDING.WORK_CS_E_PAYMENT_BILLING W
ON M.E_PAYMENT_BILL_KEY=SAFE_CAST(W.E_PAYMENT_BILL_KEY AS INT64)
WHEN NOT MATCHED THEN	
INSERT	
(	
E_PAYMENT_BILL_KEY,	
MEMBERSHIP_KEY,	
RECORD_TYPE_CD,	
ACCOUNT_NUMBER,	
CC_TYPE_CD,	
CC_EXPIRE_DTTIME,	
AMOUNT,	
CYCLE_DTTIME,	
PROCESSED_IND,	
PROCESSED_DTTIME,	
MERCHANT_NUM,	
MERCHANT_DESC,	
CLUB_CD,	
TRANS_CD,	
CLUB_PHONE_NUMBER,	
STREET_ADDRESS,	
ZIP_CD,	
REF_NB,	
E_PAYMENT_CREATE_DTTIME,	
SRC_CREATED_BY,	
CREDIT_AMT,	
PAYEE_CD,	
ORIGINAL_BILL_AMT,	
MEMBERSHIP_PAYMENT_KEY,	
ECOMM_CD,	
CARD_PRESENT_IND,	
E_PAYMENT_UPDATE_DTTIME,	
FIRST_NM,	
LAST_NM,	
CITY,	
STATE_PROV_CD,	
ENCRYPTION_KEY_ID,	
BPMT_KEY,	
ACCOUNT_NUMBER_LAST_4,	
AUTH_CODE,	
PROCESSOR,	
TRANS_REF_NR,	
ORDER_ID,	
CONTRACT_ID,	
PLAN_DTL_ID,	
E_PAYMENT_METHOD,	
TRANS_SEQ_NUM,	
TOKEN,	
DONOR_KEY,	
ETL_JOB_RUN_ID,	
SOURCE_SYSTEM_CD,	
CREATE_DTTIME,	
CREATED_BY,
UPDATE_DTTIME
)	
VALUES	
(CAST(E_PAYMENT_BILL_KEY AS INT64),
CAST(MEMBERSHIP_KEY AS INT64),
RECORD_TYPE_CD,
ACCOUNT_NUMBER,
CC_TYPE_CD,	
PARSE_DATETIME('%Y-%m-%d %H:%M:%E*S',CC_EXPIRE_DTTIME),
CAST(AMOUNT AS FLOAT64),
PARSE_DATETIME('%Y-%m-%d %H:%M:%E*S',CYCLE_DT),
PROCESSED_IND,	
PARSE_DATETIME('%Y-%m-%d %H:%M:%E*S',PROCESSED_DTTIME),
MERCHANT_NUMBER,
MERCHANT_DESCRIPTION,	
CLUB_CD,
TRANS_CD,
CLUB_PHONE_NUMBER,
STREET_ADDRESS,
ZIP_CD,
REF_NB,
PARSE_DATETIME('%Y-%m-%d %H:%M:%E*S',CREATE_DT),
CREATED_BY,	
CAST(CREDIT_AMT AS FLOAT64),
PAYEE_CD,	
CAST(ORIGINAL_BILL_AMT AS FLOAT64),	
CAST(MEMBERSHIP_PAYMENT_KEY AS INT64),
ECOMM_CD,	
CARD_PRESENT_IND,	
PARSE_DATETIME('%Y-%m-%d %H:%M:%E*S',UPDATE_DT),
FIRST_NM,	
LAST_NM,	
CITY,
STATE_PROV_CD,
CAST(ENCRYPTION_KEY_ID AS INT64),
CAST(BPMT_KY AS INT64),
ACCOUNT_NUMBER_LAST_4,
AUTH_CD,
PROCESSOR,
TRANS_REF_NR,
ORDER_ID,
CONTRACT_ID,
CAST(PLAN_DTL_ID AS INT64),
E_PAYMENT_METHOD,
CAST(TRANS_SEQ_NUMBER AS INT64),
TOKEN,
CAST(DONOR_KEY AS INT64),	
CAST('jobrunid' AS INT64),	
'CONNECT SUITE',	
CURRENT_DATETIME(),
'jobname',
CURRENT_DATETIME()
)
WHEN MATCHED THEN 	
UPDATE	
SET	
MEMBERSHIP_KEY = CAST(W.MEMBERSHIP_KEY AS INT64),	
RECORD_TYPE_CD = W.RECORD_TYPE_CD,	
ACCOUNT_NUMBER = W.ACCOUNT_NUMBER,	
CC_TYPE_CD = W.CC_TYPE_CD,	
CC_EXPIRE_DTTIME = PARSE_DATETIME('%Y-%m-%d %H:%M:%E*S',W.CC_EXPIRE_DTTIME),	
AMOUNT = CAST(W.AMOUNT AS FLOAT64),	
CYCLE_DTTIME = PARSE_DATETIME('%Y-%m-%d %H:%M:%E*S',W.CYCLE_DT),	
PROCESSED_IND = W.PROCESSED_IND,	
PROCESSED_DTTIME = PARSE_DATETIME('%Y-%m-%d %H:%M:%E*S',W.PROCESSED_DTTIME),	
MERCHANT_NUM = W.MERCHANT_NUMBER,	
MERCHANT_DESC = W.MERCHANT_DESCRIPTION,	
CLUB_CD = W.CLUB_CD,	
TRANS_CD = W.TRANS_CD,	
CLUB_PHONE_NUMBER = W.CLUB_PHONE_NUMBER,	
STREET_ADDRESS = W.STREET_ADDRESS,	
ZIP_CD = W.ZIP_CD,	
REF_NB = W.REF_NB,	
E_PAYMENT_CREATE_DTTIME = PARSE_DATETIME('%Y-%m-%d %H:%M:%E*S',W.CREATE_DT),	
SRC_CREATED_BY = W.CREATED_BY,	
CREDIT_AMT = CAST(W.CREDIT_AMT AS FLOAT64),	
PAYEE_CD = W.PAYEE_CD,	
ORIGINAL_BILL_AMT = CAST(W.ORIGINAL_BILL_AMT AS FLOAT64),	
MEMBERSHIP_PAYMENT_KEY = CAST(W.MEMBERSHIP_PAYMENT_KEY AS INT64),	
ECOMM_CD = W.ECOMM_CD,	
CARD_PRESENT_IND = W.CARD_PRESENT_IND,	
E_PAYMENT_UPDATE_DTTIME = PARSE_DATETIME('%Y-%m-%d %H:%M:%E*S',W.UPDATE_DT),	
FIRST_NM = W.FIRST_NM,	
LAST_NM = W.LAST_NM,	
CITY = W.CITY,	
STATE_PROV_CD = W.STATE_PROV_CD,	
ENCRYPTION_KEY_ID = CAST(W.ENCRYPTION_KEY_ID AS INT64),	
BPMT_KEY = CAST(W.BPMT_KY AS INT64),	
ACCOUNT_NUMBER_LAST_4 = W.ACCOUNT_NUMBER_LAST_4,	
AUTH_CODE = W.AUTH_CD,	
PROCESSOR = W.PROCESSOR,	
TRANS_REF_NR = W.TRANS_REF_NR,	
ORDER_ID = W.ORDER_ID,	
CONTRACT_ID = W.CONTRACT_ID,	
PLAN_DTL_ID = CAST(W.PLAN_DTL_ID AS INT64),	
E_PAYMENT_METHOD = W.E_PAYMENT_METHOD,	
TRANS_SEQ_NUM = CAST(W.TRANS_SEQ_NUMBER AS INT64),	
TOKEN = W.TOKEN,	
DONOR_KEY = CAST(W.DONOR_KEY AS INT64),	
ETL_JOB_RUN_ID = CAST('jobrunid' AS INT64),	
SOURCE_SYSTEM_CD = 'CONNECT SUITE',	
CREATED_BY = 'jobname',
UPDATE_DTTIME = CURRENT_DATETIME()