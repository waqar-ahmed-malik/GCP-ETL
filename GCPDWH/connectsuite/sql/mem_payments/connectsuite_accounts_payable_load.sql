MERGE INTO OPERATIONAL.CONNECTSUITE_ACCOUNTS_PAYABLE M
USING LANDING.WORK_CS_ACCOUNTS_PAYABLE W
ON M.AP_KEY=SAFE_CAST(W.AP_KEY AS INT64)
WHEN NOT MATCHED THEN
INSERT
(
AP_KEY,
AP_RECIPIENT_IND,
AP_RECIPIENT_KEY,
AP_PROCESSED_DTTIME,
AP_CREDIT_DTTIME,
AP_STUB_DESC_TX,
GL_ACCOUNT_KEY,
AP_AMT,
MEMBERSHIP_PAYMENT_KEY,
AP_ALTERNATE_ADDRESS,
AP_BASIC_ADDRESS,
AP_SUPPLEMENTARY_ADDRESS,
AP_CITY_NM,
AP_STATE_PROV_CD,
AP_ZIP_CD,
AP_PAYEE,
AP_FIRST_NM,
AP_LAST_NM,
AP_MIDDLE_INIT_NM,
AP_NOTES,
AP_CREATE_ID,
ETL_JOB_RUN_ID,
SOURCE_SYSTEM_CD,
CREATE_DTTIME,
CREATED_BY,
UPDATE_DTTIME
)
VALUES(
SAFE_CAST(AP_KEY AS INT64),
AP_RECIPIENT_IND,
SAFE_CAST(AP_RECIPIENT_KEY AS INT64),
PARSE_DATETIME('%Y-%m-%d %H:%M:%E*S',AP_PROCESSED_DTTIME),
PARSE_DATETIME('%Y-%m-%d %H:%M:%E*S',AP_CREDIT_DTTIME),
AP_STUB_DESC_TX,
SAFE_CAST(GL_ACCOUNT_KEY AS INT64),
SAFE_CAST(AP_AMT AS FLOAT64),
SAFE_CAST(MEMBERSHIP_PAYMENT_KEY AS INT64),
AP_ALTERNATE_ADDRESS,
AP_BASIC_ADDRESS,
AP_SUPPLEMENTARY_ADDRESS,
AP_CITY_NM,
AP_STATE_PROV_CD,
AP_ZIP_CD,
AP_PAYEE,
AP_FIRST_NM,
AP_LAST_NM,
AP_MIDDLE_INIT_NM,
AP_NOTES,
AP_CREATE_ID,
CAST('jobrunid' AS INT64),
'CONNECT SUITE',
CURRENT_DATETIME(),
'jobname',
CURRENT_DATETIME()
)
WHEN MATCHED THEN 
UPDATE
SET
AP_RECIPIENT_IND = W.AP_RECIPIENT_IND,
AP_RECIPIENT_KEY = SAFE_CAST(W.AP_RECIPIENT_KEY AS INT64),
AP_PROCESSED_DTTIME = PARSE_DATETIME('%Y-%m-%d %H:%M:%E*S',W.AP_PROCESSED_DTTIME),
AP_CREDIT_DTTIME = PARSE_DATETIME('%Y-%m-%d %H:%M:%E*S',W.AP_CREDIT_DTTIME),
AP_STUB_DESC_TX = W.AP_STUB_DESC_TX,
GL_ACCOUNT_KEY = SAFE_CAST(W.GL_ACCOUNT_KEY AS INT64),
AP_AMT = SAFE_CAST(W.AP_AMT AS FLOAT64),
MEMBERSHIP_PAYMENT_KEY = SAFE_CAST(W.MEMBERSHIP_PAYMENT_KEY AS INT64),
AP_ALTERNATE_ADDRESS = W.AP_ALTERNATE_ADDRESS,
AP_BASIC_ADDRESS = W.AP_BASIC_ADDRESS,
AP_SUPPLEMENTARY_ADDRESS = W.AP_SUPPLEMENTARY_ADDRESS,
AP_CITY_NM = W.AP_CITY_NM,
AP_STATE_PROV_CD = W.AP_STATE_PROV_CD,
AP_ZIP_CD = W.AP_ZIP_CD,
AP_PAYEE = W.AP_PAYEE,
AP_FIRST_NM = W.AP_FIRST_NM,
AP_LAST_NM = W.AP_LAST_NM,
AP_MIDDLE_INIT_NM = W.AP_MIDDLE_INIT_NM,
AP_NOTES = W.AP_NOTES,
AP_CREATE_ID = W.AP_CREATE_ID,
ETL_JOB_RUN_ID = CAST('jobrunid' AS INT64),
CREATED_BY = 'jobname',
UPDATE_DTTIME = CURRENT_DATETIME()
