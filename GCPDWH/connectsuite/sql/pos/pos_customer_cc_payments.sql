MERGE OPERATIONAL.POS_CUSTOMER_CC_PAYMENTS A
USING LANDING.WORK_POS_CUST_CC_PYMTS B
ON A.SALE_ID = CAST(B.SALE_ID AS INT64) AND
A.ASSOC_CD= B.ASSOC_CD AND
A.CLB_CD= B.CLB_CD AND
A.OFC_ID= B.OFC_ID AND
A.PYMT_ID= CAST(B.PYMT_ID AS INT64)
WHEN MATCHED THEN
UPDATE SET
A.CUST_CC_ACCT_NR   =		B.CUST_CC_ACCT_NR    	,
A.CUST_CC_HLDR_NM   =		B.CUST_CC_HLDR_NM    	,
A.CUST_CC_AUTH_NR   =		B.CUST_CC_AUTH_NR    	,
A.CUST_CC_CO_NM     =		B.CUST_CC_CO_NM      	,
A.CUST_CC_EXP_MTH   =		B.CUST_CC_EXP_MTH    	,
A.CUST_CC_EXP_YR    =		B.CUST_CC_EXP_YR     	,
A.CUST_CC_REF_NR    =		B.CUST_CC_REF_NR     	,
A.POST_AUTH_REQD    =		B.POST_AUTH_REQD     	,
A.CLEAR_INDC        =		B.CLEAR_INDC         	,
A.CUST_CC_CARD_TYP  =		SAFE_CAST(B.CUST_CC_CARD_TYP  AS INT64)  ,    	
A.MERCHANTID        =		B.MERCHANTID         	,
A.SETTLE_DATE       =		SAFE_CAST(B.SETTLE_DATE  AS DATETIME),     	
A.TRANS_ID          =		B.TRANS_ID           	,
A.LAST_UPDATE       =		SAFE_CAST(B.LAST_UPDATE AS DATETIME),         	
A.SEQ_NBR           =		B.SEQ_NBR            	,
A.CONVERTED         =		B.CONVERTED          	,
A.REF_ID            =		B.REF_ID             	,
A.ENCRYPTION_KEY_ID =		SAFE_CAST(B.ENCRYPTION_KEY_ID  	 AS INT64),    
A.BANK_DATE         =		B.BANK_DATE          	,
A.BANK_TIME         =		B.BANK_TIME          	,
A.SIGNATURE_DATA    =		B.SIGNATURE_DATA     	,
A.BALANCE           =		SAFE_CAST(B.BALANCE AS INT64),       	
A.CARD_TOKEN        =		B.CARD_TOKEN         	,
A.BANK_USERDATA     =		B.BANK_USERDATA      	,
A.EXPIRATION_MONTH  =		B.EXPIRATION_MONTH   	,
A.EXPIRATION_YEAR   =		B.EXPIRATION_YEAR    	,
A.APPLICATION_ID    =		B.APPLICATION_ID     	,
A.APPLICATION_LABEL =		B.APPLICATION_LABEL  	,
A.CARD_ENTRY_MODE   =		B.CARD_ENTRY_MODE    	,
A.CARDHOLDER_VERIFICATION_METHOD = 		B.CARDHOLDER_VERIFICATION_METHOD
WHEN NOT MATCHED THEN
  INSERT (
  
  ASSOC_CD,
CLB_CD,
OFC_ID,
SALE_ID,
PYMT_ID,
CUST_CC_ACCT_NR,
CUST_CC_HLDR_NM,
CUST_CC_AUTH_NR,
CUST_CC_CO_NM,
CUST_CC_EXP_MTH,
CUST_CC_EXP_YR,
CUST_CC_REF_NR,
POST_AUTH_REQD,
CLEAR_INDC,
CUST_CC_CARD_TYP,
MERCHANTID,
SETTLE_DATE,
TRANS_ID,
LAST_UPDATE,
SEQ_NBR,
CONVERTED,
REF_ID,
ENCRYPTION_KEY_ID,
BANK_DATE,
BANK_TIME,
SIGNATURE_DATA,
BALANCE,
CARD_TOKEN,
BANK_USERDATA,
EXPIRATION_MONTH,
EXPIRATION_YEAR,
APPLICATION_ID,
APPLICATION_LABEL,
CARD_ENTRY_MODE,
CARDHOLDER_VERIFICATION_METHOD,
LAST_UPDATE_DT,
JOB_RUN_ID,
SOURCE_SYSTEM_CD,
CREATE_DT
)
VALUES(
ASSOC_CD,
CLB_CD,
OFC_ID,
SAFE_CAST(SALE_ID AS INT64),
SAFE_CAST(PYMT_ID AS INT64),
CUST_CC_ACCT_NR,
CUST_CC_HLDR_NM,
CUST_CC_AUTH_NR,
CUST_CC_CO_NM,
CUST_CC_EXP_MTH,
CUST_CC_EXP_YR,
CUST_CC_REF_NR,
POST_AUTH_REQD,
CLEAR_INDC,
SAFE_CAST(CUST_CC_CARD_TYP AS INt64),
MERCHANTID,
SAFE_CAST(SETTLE_DATE AS DATETIME),
TRANS_ID,
SAFE_CAST(LAST_UPDATE AS DATETIME),
SEQ_NBR,
CONVERTED,
REF_ID,
SAFE_CAST(ENCRYPTION_KEY_ID AS INT64),
BANK_DATE,
BANK_TIME,
SIGNATURE_DATA,
SAFE_CAST(BALANCE AS INT64),
CARD_TOKEN,
BANK_USERDATA,
EXPIRATION_MONTH,
EXPIRATION_YEAR,
APPLICATION_ID,
APPLICATION_LABEL,
CARD_ENTRY_MODE,
CARDHOLDER_VERIFICATION_METHOD,
current_datetime(),
"jobrunid",
"POS",
current_datetime()
)
