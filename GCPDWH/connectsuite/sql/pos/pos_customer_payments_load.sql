-- Changed the date format on 4/17/2019
MERGE OPERATIONAL.POS_CUSTOMER_PAYMENTS A
USING LANDING.WORK_POS_CUSTOMER_PAYMENTS B
ON A.SALE_ID = CAST(B.SALE_ID AS INT64)
WHEN MATCHED THEN
UPDATE SET
A.ASSOC_CD= B.ASSOC_CD,
A.CLUB_CD= B.CLB_CD,
A.OFFICE_ID= B.OFC_ID,
A.SALE_ID= CAST(B.SALE_ID AS INT64),
A.CUST_ID= B.CUST_ID,
A.CUST_VISIT_DTTIME = CAST(B.CUST_VST_DT AS DATETIME),
A.SALE_COMPLETE_DTTIME= CAST( B.SALE_COMPLETE_DT  AS DATETIME),
A.ORD_FULFILLMENT_DTTIME= CAST(B.ORD_FULFILLMENT_DT AS DATETIME),
A.ORD_FULFILLMENT_ST= B.ORD_FULFILLMENT_ST,
A.CUST_TYPE_CD= CAST(B.CUST_TYP_CD AS INT64) ,
A.CUST_FIRST_NM= B.CUST_FST_NM,
A.CUST_LAST_NM= B.CUST_LST_NM,
A.CUST_MID_INIT_NM= B.CUST_MID_INIT_NM,
A.CUST_RECPT_TOT_SALES_AMT= CAST(B.CUST_RECPT_TOT_SLS_AMT AS FLOAT64),
A.CUST_RECPT_TAX_AMT= CAST(B.CUST_RECPT_TAX_AMT AS FLOAT64),
A.CUST_RECPT_SUBTOT_AMT= CAST(B.CUST_RECPT_SUBTOT_AMT AS FLOAT64),
A.CUST_RECPT_SAVINGS_AMT= CAST(B.CUST_RECPT_SAVINGS_AMT AS FLOAT64),
A.SHIPPING_AMT=CAST( B.SHIPPING_AMT AS FLOAT64),
A.HANDLING_AMT= CAST( B.HANDLING_AMT AS FLOAT64) ,
A.CUST_RECPT_VOID_RET_IND= B.CUST_RECPT_VOID_RET_IND,
A.COUNTY_TAX_AMT= CAST( B.CNTY_TAX_AMT AS FLOAT64) ,
A.LOCAL_TAX_AMT= CAST( B.LCL_TAX_AMT AS FLOAT64) ,
A.STATE_TAX_AMT= CAST( B.ST_TAX_AMT AS FLOAT64) ,
A.OTHER_TAX_AMT= CAST( B.OTH_TAX_AMT AS FLOAT64) ,
A.SHIP_TO_ID= CAST(B.SHIP_TO_ID AS INT64),
A.ADDITIONAL_INFO_TXT= B.ADDITIONAL_INFO_TXT,
A.SUSPECIOUS= B.SUSPECIOUS,
A.SUSPECIOUS_NOTE= B.SUSPECIOUS_NOTE,
A.CUST_RECPT_PROMOTIONS_AMT= CAST(B.CUST_RECPT_PROMOTIONS_AMT AS FLOAT64),
A.CONTACT_OBJECT_ID= B.CONTACT_OBJECT_ID,
A.EXTERNAL_ID= B.EXTERNAL_ID,
A.STATE_TAX_PERCENT= CAST( B.STATE_TAX_PERCENT AS FLOAT64) ,
A.COUNTY_TAX_PERCENT=CAST( B.COUNTY_TAX_PERCENT AS FLOAT64) ,
A.LOCAL_TAX_PERCENT= CAST( B.LOCAL_TAX_PERCENT AS FLOAT64) ,
A.OTHER_TAX_PERCENT= CAST( B.OTHER_TAX_PERCENT AS FLOAT64) ,
A.CASH_AMT= CAST( B.CASH_AMT AS FLOAT64)  ,
A.CHECK_AMT= CAST( B.CHECK_AMT AS FLOAT64)  ,
A.AMEX_AMT= CAST( B.AMEX_AMT AS FLOAT64)  ,
A.VISA_AMT= CAST( B.VISA_AMT AS FLOAT64)  ,
A.MASTERCARD_AMT=CAST( B.MASTERCARD_AMT AS FLOAT64)   ,
A.DISCOVER_AMT=CAST( B.DISCOVER_AMT AS FLOAT64)   ,
A.DEBIT_AMT= CAST( B.DEBIT_AMT AS FLOAT64)  ,
A.CASH_NET= CAST( B.CASH_NET AS FLOAT64),
A.CHECK_NET= CAST(B.CHECK_NET AS FLOAT64),
A.CC_NET= CAST(B.CC_NET AS FLOAT64),
A.MISC_AMT= CAST(B.MISC_AMT AS FLOAT64),
A.MISC_NET= CAST(B.MISC_NET AS FLOAT64),
A.TENDER_TOTAL= CAST( B.TENDER_TOTAL AS FLOAT64),
A.CONSULTANT_ID=B.CONSULTANT_ID,
A.CUST_RECPT_NR=CAST(B.CUST_RECPT_NR AS INT64),
A.CUST_VST_DT=CAST(B.CUST_VST_DT AS DATETIME),
A.UPLOAD_TRANS_NR=CAST(B.UPLOAD_TRANS_NR AS INT64),
A.CUST_PYMT_AMT=CAST( B.CUST_PYMT_AMT AS FLOAT64),
A.WKST_ID=B.WKST_ID,
A.LAST_UPDATE=CAST(B.LAST_UPDATE  AS DATETIME)
WHEN NOT MATCHED THEN
  INSERT (ASSOC_CD,
CLUB_CD,
OFFICE_ID,
SALE_ID,
CUST_ID,
CUST_VISIT_DTTIME,
SALE_COMPLETE_DTTIME,
ORD_FULFILLMENT_DTTIME,
ORD_FULFILLMENT_ST,
CUST_TYPE_CD,
CUST_FIRST_NM,
CUST_LAST_NM,
CUST_MID_INIT_NM,
CUST_RECPT_TOT_SALES_AMT,
CUST_RECPT_TAX_AMT,
CUST_RECPT_SUBTOT_AMT,
CUST_RECPT_SAVINGS_AMT,
SHIPPING_AMT,
HANDLING_AMT,
CUST_RECPT_VOID_RET_IND,
COUNTY_TAX_AMT,
LOCAL_TAX_AMT,
STATE_TAX_AMT,
OTHER_TAX_AMT,
SHIP_TO_ID,
ADDITIONAL_INFO_TXT,
SUSPECIOUS,
SUSPECIOUS_NOTE,
CUST_RECPT_PROMOTIONS_AMT,
CONTACT_OBJECT_ID,
EXTERNAL_ID,
STATE_TAX_PERCENT,
COUNTY_TAX_PERCENT,
LOCAL_TAX_PERCENT,
OTHER_TAX_PERCENT,
CASH_AMT,
CHECK_AMT,
AMEX_AMT,
VISA_AMT,
MASTERCARD_AMT,
DISCOVER_AMT,
DEBIT_AMT,
CASH_NET,
CHECK_NET,
CC_NET,
MISC_AMT,
MISC_NET,
TENDER_TOTAL,
CONSULTANT_ID,
CUST_RECPT_NR,
CUST_VST_DT,
UPLOAD_TRANS_NR,
CUST_PYMT_AMT,
WKST_ID,
LAST_UPDATE,
JOB_RUN_ID,
SOURCE_SYSTEM_CD,
CREATE_DT
)
VALUES(ASSOC_CD,
CLB_CD,
OFC_ID,
CAST(SALE_ID AS INT64),
CUST_ID,
CAST(CUST_VST_DT  AS DATETIME),
CAST(SALE_COMPLETE_DT  AS DATETIME),
CAST(ORD_FULFILLMENT_DT AS DATETIME),
ORD_FULFILLMENT_ST,
CAST(CUST_TYP_CD AS INT64),
CUST_FST_NM,
CUST_LST_NM,
CUST_MID_INIT_NM,
CAST(CUST_RECPT_TOT_SLS_AMT AS FLOAT64),
CAST(CUST_RECPT_TAX_AMT AS FLOAT64) ,
CAST(CUST_RECPT_SUBTOT_AMT AS FLOAT64) ,
CAST(CUST_RECPT_SAVINGS_AMT AS FLOAT64) ,
CAST(HANDLING_AMT AS FLOAT64) ,
CAST(CUST_RECPT_TAX_AMT AS FLOAT64) ,
CUST_RECPT_VOID_RET_IND,
CAST(CNTY_TAX_AMT AS FLOAT64),
CAST(LCL_TAX_AMT AS FLOAT64) ,
CAST(ST_TAX_AMT AS FLOAT64),
CAST(OTH_TAX_AMT AS FLOAT64) ,
CAST(SHIP_TO_ID AS INT64),
ADDITIONAL_INFO_TXT,
SUSPECIOUS,
SUSPECIOUS_NOTE,
CAST(CUST_RECPT_PROMOTIONS_AMT AS FLOAT64),
CONTACT_OBJECT_ID,
EXTERNAL_ID,
CAST(STATE_TAX_PERCENT AS FLOAT64) ,
CAST(COUNTY_TAX_PERCENT AS FLOAT64) ,
CAST(LOCAL_TAX_PERCENT AS FLOAT64) ,
CAST(OTHER_TAX_PERCENT AS FLOAT64) ,
CAST(CASH_AMT AS FLOAT64) ,
CAST(CHECK_AMT AS FLOAT64) ,
CAST(AMEX_AMT AS FLOAT64) ,
CAST(VISA_AMT AS FLOAT64),
CAST(MASTERCARD_AMT AS FLOAT64) ,
CAST(DISCOVER_AMT AS FLOAT64) ,
CAST(DISCOVER_AMT AS FLOAT64) ,
CAST(CASH_NET AS FLOAT64) ,
CAST(CHECK_NET AS FLOAT64) ,
CAST(CC_NET AS FLOAT64) ,
CAST(MISC_AMT AS FLOAT64) ,
CAST(MISC_NET AS FLOAT64) ,
CAST(TENDER_TOTAL AS FLOAT64),
CONSULTANT_ID,
CAST(CUST_RECPT_NR AS INT64),
CAST(CUST_VST_DT  AS DATETIME),
CAST(UPLOAD_TRANS_NR AS INT64),
CAST(CUST_PYMT_AMT AS FLOAT64),
WKST_ID,
CAST(LAST_UPDATE  AS DATETIME),
'12345',
'POS' ,
CURRENT_DATETIME()
)