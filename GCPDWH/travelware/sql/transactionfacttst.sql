SELECT EMAIL TRAVELER_EMAIL,
TST_TRIP_ID TST_TRIP_ID,
SUPPLIER INVENTORY_SUPPLIER,
"TST" SOURCE_SYSTEM_CD,
TST_BOOKING_ID SOURCE_SYSTEM_ID,
MEMBERSHIP_NUMBER MEMBERSHIP_NUM,
SUBSTR( MEMBERSHIP_NUMBER , 15,1)  ASSOCIATE_ID ,
SUBSTR( MEMBERSHIP_NUMBER , 4,3)	CLUB_CD,
NULL AS INVOICE_NUM,
SAFE_CAST(NULL  AS DATE) AS INVOICE_DT,
TRAVEL_TYPE SALE_TYPE_CD,
TRAVEL_TYPE SALE_TYPE_DESC,
TOTAL_GROSS_SALE_AMOUNT SALE_POSTED_AMOUNT,
TRAVEL_TYPE TRAVEL_TYPE_CD,
TRAVEL_TYPE TRAVEL_TYPE_DESC,
TST_BOOKING_ID SALE_NUM,
TST_AGENT_ID BOOKING_AGENT_ID, 
TST_AGENT_ID TICKETING_AGENT_ID,
CLUB_AGENT_ID SELLING_AGENT_ID,
LPAD(ZIP.BRANCH_ID,3,'0') NCNU_BRANCH_CD,
DATE(TRAVEL_START_DATE) DEPARTURE_DT,
DATE(TRAVEL_END_DATE) RETURN_DT,
SUBTOTAL_AMOUNT BASE_FARE,
TOTAL_GROSS_SALE_AMOUNT TOTAL_COST,
ESTIMATED_COMMISSION_AGENCY ANTICIPATED_COMMISSION_AMOUNT,
CAST(NULL AS FLOAT64) ANTICIPATED_SALE_AMOUNT,
DESTINATION_CITY ,
PASSENGER_COUNT,
CASE WHEN UPPER(TRAVEL_TYPE) = 'AIR' THEN VENDOR ELSE NULL END AS AIRLINE, 
PROVIDER_REFERENCE_NUMBER TICKET_NUM,
VENDOR PROVIDER,
DATE(BOOKING_DATE ) BOOKING_DT,
TRAVEL_TYPE BOOKING_TYPE,
DATE(MODIFIED_DATE) CHANGE_DT,
SAFE_CAST (CANCELLATION_DATE AS DATE) CANCELLATION_DT,
DATE(BOOKING_DATE) SALE_POSTING_DT,
SAFE_CAST(NULL AS STRING) AS STATUS_CD,
STATUS STATUS_CD_DESC,
PROVIDER_REFERENCE_NUMBER PNR_LOCATOR,
MDM.CUSTOMER_MDM_KEY MDM_CUSTOMER_KEY,
SAFE_CAST(NULL AS STRING) AS SETTLE_CD,
SAFE_CAST(NULL AS STRING) SETTLE_CD_DESC,
SAFE_CAST(NULL AS STRING) SOJOURN_CD,
SAFE_CAST(NULL AS STRING)  AS CUSTOMER_TYPE_CD,
SAFE_CAST(NULL AS STRING)  AS CUSTOMER_TYPE_DESC,
CAST(NULL AS FLOAT64)  AS COMMISSION_PERCENT,
CAST(NULL AS FLOAT64)  AS COMMISSION_AMOUNT,
SAFE_CAST(NULL AS STRING)  AS REVENUE_TYPE_CD,
SAFE_CAST(NULL AS STRING)  AS REVENUE_TYPE_DESC,
SAFE_CAST(NULL AS STRING)  AS INVOICE_POSTED_FLAG,
SAFE_CAST(NULL AS STRING)  AS PROMOTION_CD,
SAFE_CAST(NULL AS STRING)  AS AUTO_TRAVEL_FLAG,
SAFE_CAST(NULL AS STRING)  AS SOURCE_SYSTEM_BRANCH_CD,
SAFE_CAST(NULL AS STRING)  AS STP,
SAFE_CAST(NULL AS STRING)  AS DESTINATION_REGION,
SAFE_CAST(NULL AS STRING)  AS ITINERARY,
CURRENT_DATE() RECORD_LOAD_DT,
CAST(ROW_NUMBER() OVER () AS STRING) RECORD_LOAD_ID
FROM 
LANDING.TRAVEL_TST TST
LEFT JOIN CUSTOMER_PRODUCT.BRANCH_ZIP_DIM ZIP
ON TST.ZIP=ZIP.ZIP_CODE
LEFT JOIN (SELECT DISTINCT CUSTOMER_MDM_KEY, SOURCE_KEY1 FROM  CUSTOMERS.MDM_CUSTOMER_BRIDGE WHERE SOURCE_SYSTEM='TST') MDM
ON MDM.SOURCE_KEY1=TST.TST_BOOKING_ID