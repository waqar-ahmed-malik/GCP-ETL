MERGE CUSTOMER_PRODUCT.TRAVEL_TRANSACTION_FACT AS TGT
USING LANDING.WORK_TRAVEL_GLOBALWARE_TRANSACTIONS AS SRC
ON TGT.SOURCE_TRANSACTION_ID = SRC.SOURCE_TRANSACTION_ID 
AND TGT.SOURCE_SYSTEM_CD = SRC.SOURCE_SYSTEM_CD
WHEN MATCHED
THEN UPDATE SET
TGT.TRIP_TRANSACTION_NUM = SRC.TRIP_TRANSACTION_NUM,
TGT.TRANSACTION_DT = SAFE_CAST(SRC.TRANSACTION_DT AS STRING),
TGT.CUSTOMER_MDM_KEY = SRC.MDM_CUSTOMER_KEY,
TGT.MEMBER_NUM = SRC.MEMBER_NUM,
TGT.TRAVELER_MEMBERSHIP_NUM = SRC.TRAVELER_MEMBERSHIP_NUM,
TGT.TRAVELER_ASSOCIATE_ID = SRC.TRAVELER_ASSOCIATE_ID,
TGT.CLUB_CD = SRC.CLUB_CD,
TGT.SALE_TYPE_CD = SRC.SALE_TYPE_CD,
TGT.SALE_TYPE_DESC = SRC.SALE_TYPE_DESC,
TGT.SALE_POSTED_AMT = SRC.SALE_POSTED_AMT,
TGT.TRAVEL_TYPE_CD = SRC.TRAVEL_TYPE_CD,
TGT.TRAVEL_TYPE_DESC = SRC.TRAVEL_TYPE_DESC,
TGT.SALE_NUM = SRC.SALE_NUM,
TGT.BOOKING_DT = SRC.BOOKING_DT,
TGT.BOOKING_TYPE = SRC.BOOKING_TYPE,
TGT.DEPARTURE_DT = SAFE_CAST(SRC.DEPARTURE_DT AS STRING),
TGT.RETURN_DT = SAFE_CAST(SRC.RETURN_DT AS STRING),
TGT.CHANGE_DT = SAFE_CAST(SRC.CHANGE_DT AS STRING),
TGT.CANCELLATION_DT = SAFE_CAST(SRC.CANCELLATION_DT AS STRING),
TGT.SALE_POSTING_DT = SAFE_CAST(SRC.SALE_POSTING_DT AS STRING),
TGT.BOOKING_AGENT_ID = SRC.BOOKING_AGENT_ID,
TGT.BOOKING_EMPLOYEE_ID = SRC.BOOKING_EMPLOYEE_ID,
TGT.BOOKING_LOCATION_ID = SRC.BOOKING_LOCATION_ID,
TGT.TICKETING_AGENT_ID = SRC.TICKETING_AGENT_ID,
TGT.TICKETING_EMPLOYEE_ID = SRC.TICKETING_EMPLOYEE_ID,
TGT.TICKETING_LOCATION_ID = SRC.TICKETING_LOCATION_ID,
TGT.SELLING_AGENT_ID = SRC.SELLING_AGENT_ID,
TGT.COMPENSATION_EMPLOYEE_ID = SRC.COMPENSATION_EMPLOYEE_ID,
TGT.SELLING_LOCATION_ID = SRC.SELLING_LOCATION_ID,
TGT.REVENUE_LOCATION_ID = SRC.REVENUE_LOCATION_ID,
TGT.TRAVEL_LOCATION_ID = SRC.TRAVEL_LOCATION_ID,
TGT.BASE_FARE = SRC.BASE_FARE,
TGT.TOTAL_COST = SRC.TOTAL_COST,
TGT.COMMISSION_PERCENT = SRC.COMMISSION_PERCENT,
TGT.COMMISSION_AMT = SRC.COMMISSION_AMOUNT,
TGT.ANTICIPATED_SALE_AMT = SRC.ANTICIPATED_SALE_AMT,
TGT.ANTICIPATED_COMMISSION_AMT = SRC.ANTICIPATED_COMMISSION_AMT,
TGT.DESTINATION_CITY = SRC.DESTINATION_CITY,
TGT.DESTINATION_REGION = SRC.DESTINATION_REGION,
TGT.PASSENGER_COUNT = SRC.PASSENGER_COUNT,
TGT.AIRLINE = SRC.AIRLINE,
TGT.TICKET_NUM = SRC.TICKET_NUM,
TGT.ITINERARY = SRC.ITINERARY,
TGT.PROVIDER = SRC.PROVIDER,
TGT.STATUS_CD = SRC.STATUS_CD,
TGT.STATUS_CD_DESC = SRC.STATUS_CD_DESC,
TGT.PNR_LOCATOR = SRC.PNR_LOCATOR,
TGT.SETTLE_CD = SRC.SETTLE_CD,
TGT.SETTLE_CD_DESC = SRC.SETTLE_CD_DESC,
TGT.SOJOURN_CD = SRC.SOJOURN_CD,
TGT.CUSTOMER_TYPE_CD = SRC.CUSTOMER_TYPE_CD,
TGT.CUSTOMER_TYPE_DESC = SRC.CUSTOMER_TYPE_DESC,
TGT.REVENUE_TYPE_CD = SRC.REVENUE_TYPE_CD,
TGT.REVENUE_TYPE_DESC = SRC.REVENUE_TYPE_DESC,
TGT.INVOICE_POSTED_FLAG = SRC.INVOICE_POSTED_FLAG,
TGT.PROMOTION_CD = SRC.PROMOTION_CD,
TGT.AUTO_TRAVEL_FLAG = SRC.AUTO_TRAVEL_FLAG,
TGT.SOURCE_SYSTEM_BRANCH_CD = SRC.SOURCE_SYSTEM_BRANCH_CD,
TGT.STP = SRC.STP,
TGT.INVENTORY_SUPPLIER = SRC.INVENTORY_SUPPLIER,
TGT.DOMINT=SRC.DOMINT,
TGT.TAX1=SRC.TAX1,
TGT.TAX2=SRC.TAX2,
TGT.TAX3=SRC.TAX3,
TGT.TAX4=SRC.TAX4,
TGT.MISC_CHARGE=SRC.MISC_CHARGE,
TGT.DISCOUNT=SRC.DISCOUNT,
TGT.EXCHANGE=SRC.EXCHANGE,
TGT.FOP=SRC.FOP,
TGT.UPDATE_DTTIME = CURRENT_DATETIME()

WHEN NOT MATCHED THEN INSERT 
(
SOURCE_TRANSACTION_ID,
SOURCE_SYSTEM_CD,
TRIP_TRANSACTION_NUM,
TRANSACTION_DT,
CUSTOMER_MDM_KEY,
MEMBER_NUM,
TRAVELER_MEMBERSHIP_NUM,
TRAVELER_ASSOCIATE_ID,
CLUB_CD,
SALE_TYPE_CD,
SALE_TYPE_DESC,
SALE_POSTED_AMT,
TRAVEL_TYPE_CD,
TRAVEL_TYPE_DESC,
SALE_NUM,
BOOKING_DT,
BOOKING_TYPE,
DEPARTURE_DT,
RETURN_DT,
CHANGE_DT,
CANCELLATION_DT,
SALE_POSTING_DT,
BOOKING_AGENT_ID,
BOOKING_EMPLOYEE_ID,
BOOKING_LOCATION_ID,
TICKETING_AGENT_ID,
TICKETING_EMPLOYEE_ID,
TICKETING_LOCATION_ID,
SELLING_AGENT_ID,
COMPENSATION_EMPLOYEE_ID,
SELLING_LOCATION_ID,
REVENUE_LOCATION_ID,
TRAVEL_LOCATION_ID,
BASE_FARE,
TOTAL_COST,
COMMISSION_PERCENT,
COMMISSION_AMT,
ANTICIPATED_SALE_AMT,
ANTICIPATED_COMMISSION_AMT,
DESTINATION_CITY,
DESTINATION_REGION,
PASSENGER_COUNT,
AIRLINE,
TICKET_NUM,
ITINERARY,
PROVIDER,
STATUS_CD,
STATUS_CD_DESC,
PNR_LOCATOR,
SETTLE_CD,
SETTLE_CD_DESC,
SOJOURN_CD,
CUSTOMER_TYPE_CD,
CUSTOMER_TYPE_DESC,
REVENUE_TYPE_CD,
REVENUE_TYPE_DESC,
INVOICE_POSTED_FLAG,
PROMOTION_CD,
AUTO_TRAVEL_FLAG,
SOURCE_SYSTEM_BRANCH_CD,
STP,
INVENTORY_SUPPLIER,
DOMINT,
TAX1,
TAX2,
TAX3,
TAX4,
MISC_CHARGE,
DISCOUNT,
EXCHANGE, 
FOP,
CREATE_DTTIME,
UPDATE_DTTIME
)
VALUES
(
SRC.SOURCE_TRANSACTION_ID,
SRC.SOURCE_SYSTEM_CD,
SRC.TRIP_TRANSACTION_NUM,
SAFE_CAST(SRC.TRANSACTION_DT AS STRING),
SRC.MDM_CUSTOMER_KEY,
SRC.MEMBER_NUM,
SRC.TRAVELER_MEMBERSHIP_NUM,
SRC.TRAVELER_ASSOCIATE_ID,
SRC.CLUB_CD,
SRC.SALE_TYPE_CD,
SRC.SALE_TYPE_DESC,
SRC.SALE_POSTED_AMT,
SRC.TRAVEL_TYPE_CD,
SRC.TRAVEL_TYPE_DESC,
SRC.SALE_NUM,
SRC.BOOKING_DT,
SRC.BOOKING_TYPE,
SAFE_CAST(SRC.DEPARTURE_DT AS STRING),
SAFE_CAST(SRC.RETURN_DT AS STRING),
SAFE_CAST(SRC.CHANGE_DT AS STRING),
SAFE_CAST(SRC.CANCELLATION_DT AS STRING),
SAFE_CAST(SRC.SALE_POSTING_DT AS STRING),
SRC.BOOKING_AGENT_ID,
SRC.BOOKING_EMPLOYEE_ID,
SRC.BOOKING_LOCATION_ID,
SRC.TICKETING_AGENT_ID,
SRC.TICKETING_EMPLOYEE_ID,
SRC.TICKETING_LOCATION_ID,
SRC.SELLING_AGENT_ID,
SRC.COMPENSATION_EMPLOYEE_ID,
SRC.SELLING_LOCATION_ID,
SRC.REVENUE_LOCATION_ID,
SRC.TRAVEL_LOCATION_ID,
SRC.BASE_FARE,
SRC.TOTAL_COST,
SRC.COMMISSION_PERCENT,
SRC.COMMISSION_AMOUNT,
SRC.ANTICIPATED_SALE_AMT,
SRC.ANTICIPATED_COMMISSION_AMT,
SRC.DESTINATION_CITY,
SRC.DESTINATION_REGION,
SRC.PASSENGER_COUNT,
SRC.AIRLINE,
SRC.TICKET_NUM,
SRC.ITINERARY,
SRC.PROVIDER,
SRC.STATUS_CD,
SRC.STATUS_CD_DESC,
SRC.PNR_LOCATOR,
SRC.SETTLE_CD,
SRC.SETTLE_CD_DESC,
SRC.SOJOURN_CD,
SRC.CUSTOMER_TYPE_CD,
SRC.CUSTOMER_TYPE_DESC,
SRC.REVENUE_TYPE_CD,
SRC.REVENUE_TYPE_DESC,
SRC.INVOICE_POSTED_FLAG,
SRC.PROMOTION_CD,
SRC.AUTO_TRAVEL_FLAG,
SRC.SOURCE_SYSTEM_BRANCH_CD,
SRC.STP,
SRC.INVENTORY_SUPPLIER,
SRC.DOMINT,
SRC.TAX1,
SRC.TAX2,
SRC.TAX3,
SRC.TAX4,
SRC.MISC_CHARGE,
SRC.DISCOUNT,
SRC.EXCHANGE,
SRC.FOP,
SRC.CREATE_DTTIME,
CURRENT_DATETIME()
)
