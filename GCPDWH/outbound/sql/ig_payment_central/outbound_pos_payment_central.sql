select PC_STRING from 
(SELECT 1 AS RECORD_IDENTIFIER,CONCAT(RECORD_IDENTIFIER,ENVIRONMENT_TYPE,BATCH_JOB_APPLICATION_NAME,BATCH_JOB_NAME,BATCH_JOB_SERVER_NAME,
BATCH_FILE_NAME,' ',BATCH_FILE_CREATION_DATE_TIME,BATCH_FILE_SEQ_NUMBER) AS PC_STRING FROM 
(SELECT 
DISTINCT 'HDR' AS RECORD_IDENTIFIER,
CASE WHEN catalog_name='aaa-mwg-dwprod' THEN RPAD('PROD',6,' ') ELSE RPAD('TEST',6,' ') end AS ENVIRONMENT_TYPE,
RPAD('NCNUPOS',9,' ') AS BATCH_JOB_APPLICATION_NAME,
RPAD('POS',30,' ') AS BATCH_JOB_NAME,
RPAD(catalog_name,20,' ') AS BATCH_JOB_SERVER_NAME,
CONCAT('{{ execution_date.strftime("%Y%m%d_%H%M%S") }}','_PMT_E_NCNUCLUB_PMTCTRL_7022_D.fix') AS BATCH_FILE_NAME,
CAST({{ execution_date.strftime("%Y%m%d%H%M%S") }} AS STRING) AS BATCH_FILE_CREATION_DATE_TIME,
'01' AS BATCH_FILE_SEQ_NUMBER
 FROM
 INFORMATION_SCHEMA.SCHEMATA)
union all
select  2 AS RECORD_IDENTIFIER,
CONCAT(RPAD(IFNULL(CAST(PC.RECORD_IDENTIFIER AS STRING),''),3,' '),
LPAD(IFNULL(CAST(PC.BRANCH_NUMBER AS STRING),''),3,'0'),
LPAD(IFNULL(CAST(PC.BRANCH_HUB_NUMBER AS STRING),''),3,'0'),
LPAD(IFNULL(CAST(PC.BRANCH_DEVICE_NUMBER AS STRING),''),3,'0'),
LPAD(IFNULL(CAST(PC.CLUB_CODE AS STRING),'005'),3,'0'),
RPAD(IFNULL(CAST(PC.USER_ID AS STRING),' '),10,' '),
RPAD(IFNULL(CONCAT(LPAD(IFNULL(CAST(BRANCH_NUMBER AS STRING),''),3,'0'),LPAD(IFNULL(CAST(BRANCH_DEVICE_NUMBER AS STRING),''),3,'0'),LPAD(IFNULL(CAST(POS_TRANSACTION_ID AS STRING),''),9,'0')),' '),15,' '),
RPAD(IFNULL(CAST(PC.TRANSACTION_DATE AS STRING),' '),8,' '),
RPAD(IFNULL(CAST(PC.TRANSACTION_TIME AS STRING),' '),6,' '),
RPAD(IFNULL(CAST(PC.TRANSACTION_POSTMARK_DATE AS STRING),' '),8,' '),
LPAD(IFNULL(FORMAT("%.*f",2,CAST(PC.TRANSACTION_TOTAL_AMOUNT AS FLOAT64) + .0001),RPAD('',10,' ')),10,'0'),
IFNULL(CASE WHEN CASH_TRANSACTION_FOP='CASH' THEN RPAD(IFNULL(CAST(PC.CASH_TRANSACTION_FOP AS STRING),' '),4,' ')
	 WHEN CASH_TRANSACTION_FOP='CHCK' THEN RPAD(IFNULL(CAST(PC.CHCK_TRANSACTION_FOP AS STRING),' '),4,' ')
	 ELSE RPAD('',4,' ') END,RPAD('',4,' ')),
IFNULL(CASE WHEN CASH_TRANSACTION_FOP='CASH' THEN LPAD(IFNULL(FORMAT("%.*f",2,CAST(PC.CASH_FOP_AMOUNT AS FLOAT64) + .0001),RPAD('',10,' ')),10,'0')
	 WHEN CASH_TRANSACTION_FOP='CHCK' THEN LPAD(IFNULL(FORMAT("%.*f",2,CAST(PC.CHCK_FOP_AMOUNT AS FLOAT64) + .0001),RPAD('',10,' ')),10,'0')
	 ELSE RPAD('',10,' ') END,RPAD('',10,' ')),
RPAD('',5,' '),
RPAD('',4,' '),
RPAD('',2,' '),
RPAD('',4,' '),
RPAD('',22,' '),
RPAD('',20,' '),
RPAD('',9,' '),
IFNULL(CASE WHEN CASH_TRANSACTION_FOP='CASH' AND CASH_TRANSACTION_FOP='CHCK' THEN RPAD(IFNULL(CAST(PC.CHCK_TRANSACTION_FOP AS STRING),' '),4,' ')  ELSE RPAD('',4,' ') END,RPAD('',4,' ')),
IFNULL(CASE WHEN CASH_TRANSACTION_FOP='CASH' AND CASH_TRANSACTION_FOP='CHCK' THEN LPAD(IFNULL(FORMAT("%.*f",2,CAST(PC.CHCK_FOP_AMOUNT AS FLOAT64) + .0001),RPAD('',10,' ')),10,'0')
	 ELSE RPAD('',10,' ') END,RPAD('',10,' ')),
RPAD('',5,' '),
RPAD('',4,' '),
RPAD('',2,' '),
RPAD('',4,' '),
RPAD('',22,' '),
RPAD('',20,' '),
RPAD('',9,' '),
RPAD('',4,' '),
RPAD('',10,' '),
RPAD('',5,' '),
RPAD('',4,' '),
RPAD('',2,' '),
RPAD('',4,' '),
RPAD('',22,' '),
RPAD('',20,' '),
RPAD('',9,' '),
RPAD('',4,' '),
RPAD('',10,' '),
RPAD('',5,' '),
RPAD('',4,' '),
RPAD('',2,' '),
RPAD('',4,' '),
RPAD('',22,' '),
RPAD('',20,' '),
RPAD('',9,' '),
RPAD('',4,' '),
RPAD('',10,' '),
RPAD('',5,' '),
RPAD('',4,' '),
RPAD('',2,' '),
RPAD('',4,' '),
RPAD('',22,' '),
RPAD('',20,' '),
RPAD('',9,' '),
RPAD(IFNULL(CAST(PC.LI1_AGMT_SOURCE_SYSTEM AS STRING),' '),9,' '),
RPAD(IFNULL(CAST(PC.LI1_COMPANY_ID AS STRING),' '),6,' '),
RPAD(IFNULL(CAST(PC.LI1_PRODUCT_TYPE AS STRING),' '),2,' '),
RPAD(IFNULL(CAST(PC.LI1_POLICY_PREFIX AS STRING),' '),4,' '),
RPAD(IFNULL(CAST(PC.LI1_AGMT_NUMBER AS STRING),' '),16,' '),
RPAD(IFNULL(CAST(PC.LI1_AGMT_STATE_CODE AS STRING),' '),2,' '),
LPAD(IFNULL(FORMAT("%.*f",2,CAST(PC.LI1_LINE_ITEM_AMOUNT AS FLOAT64) + .0001),RPAD('',10,' ')),10,'0'),
RPAD(IFNULL(CAST(PC.LI2_AGMT_SOURCE_SYSTEM AS STRING),' '),9,' '),
RPAD(IFNULL(CAST(PC.LI2_COMPANY_ID AS STRING),' '),6,' '),
RPAD(IFNULL(CAST(PC.LI2_PRODUCT_TYPE AS STRING),' '),2,' '),
RPAD(IFNULL(CAST(PC.LI2_POLICY_PREFIX AS STRING),' '),4,' '),
RPAD(IFNULL(CAST(PC.LI2_AGMT_NUMBER AS STRING),' '),16,' '),
RPAD(IFNULL(CAST(PC.LI2_AGMT_STATE_CODE AS STRING),' '),2,' '),
LPAD(IFNULL(FORMAT("%.*f",2,CAST(PC.LI2_LINE_ITEM_AMOUNT AS FLOAT64) + .0001),RPAD('',10,' ')),10,'0'),
RPAD(IFNULL(CAST(PC.LI3_AGMT_SOURCE_SYSTEM AS STRING),' '),9,' '),
RPAD(IFNULL(CAST(PC.LI3_COMPANY_ID AS STRING),' '),6,' '),
RPAD(IFNULL(CAST(PC.LI3_PRODUCT_TYPE AS STRING),' '),2,' '),
RPAD(IFNULL(CAST(PC.LI3_POLICY_PREFIX AS STRING),' '),4,' '),
RPAD(IFNULL(CAST(PC.LI3_AGMT_NUMBER AS STRING),' '),16,' '),
RPAD(IFNULL(CAST(PC.LI3_AGMT_STATE_CODE AS STRING),' '),2,' '),
LPAD(IFNULL(FORMAT("%.*f",2,CAST(PC.LI3_LINE_ITEM_AMOUNT AS FLOAT64) + .0001),RPAD('',10,' ')),10,'0'),
RPAD(IFNULL(CAST(PC.LI4_AGMT_SOURCE_SYSTEM AS STRING),' '),9,' '),
RPAD(IFNULL(CAST(PC.LI4_COMPANY_ID AS STRING),' '),6,' '),
RPAD(IFNULL(CAST(PC.LI4_PRODUCT_TYPE AS STRING),' '),2,' '),
RPAD(IFNULL(CAST(PC.LI4_POLICY_PREFIX AS STRING),' '),4,' '),
RPAD(IFNULL(CAST(PC.LI4_AGMT_NUMBER AS STRING),' '),16,' '),
RPAD(IFNULL(CAST(PC.LI4_AGMT_STATE_CODE AS STRING),' '),2,' '),
LPAD(IFNULL(FORMAT("%.*f",2,CAST(PC.LI4_LINE_ITEM_AMOUNT AS FLOAT64) + .0001),RPAD('',10,' ')),10,'0'),
RPAD(IFNULL(CAST(PC.LI5_AGMT_SOURCE_SYSTEM AS STRING),' '),9,' '),
RPAD(IFNULL(CAST(PC.LI5_COMPANY_ID AS STRING),' '),6,' '),
RPAD(IFNULL(CAST(PC.LI5_PRODUCT_TYPE AS STRING),' '),2,' '),
RPAD(IFNULL(CAST(PC.LI5_POLICY_PREFIX AS STRING),' '),4,' '),
RPAD(IFNULL(CAST(PC.LI5_AGMT_NUMBER AS STRING),' '),16,' '),
RPAD(IFNULL(CAST(PC.LI5_AGMT_STATE_CODE AS STRING),' '),2,' '),
LPAD(IFNULL(FORMAT("%.*f",2,CAST(PC.LI5_LINE_ITEM_AMOUNT AS FLOAT64) + .0001),RPAD('',10,' ')),10,'0'),
RPAD(IFNULL(CAST(PC.LI6_AGMT_SOURCE_SYSTEM AS STRING),' '),9,' '),
RPAD(IFNULL(CAST(PC.LI6_COMPANY_ID AS STRING),' '),6,' '),
RPAD(IFNULL(CAST(PC.LI6_PRODUCT_TYPE AS STRING),' '),2,' '),
RPAD(IFNULL(CAST(PC.LI6_POLICY_PREFIX AS STRING),' '),4,' '),
RPAD(IFNULL(CAST(PC.LI6_AGMT_NUMBER AS STRING),' '),16,' '),
RPAD(IFNULL(CAST(PC.LI6_AGMT_STATE_CODE AS STRING),' '),2,' '),
LPAD(IFNULL(FORMAT("%.*f",2,CAST(PC.LI6_LINE_ITEM_AMOUNT AS FLOAT64) + .0001),RPAD('',10,' ')),10,'0'),
RPAD(IFNULL(CAST(PC.LI7_AGMT_SOURCE_SYSTEM AS STRING),' '),9,' '),
RPAD(IFNULL(CAST(PC.LI7_COMPANY_ID AS STRING),' '),6,' '),
RPAD(IFNULL(CAST(PC.LI7_PRODUCT_TYPE AS STRING),' '),2,' '),
RPAD(IFNULL(CAST(PC.LI7_POLICY_PREFIX AS STRING),' '),4,' '),
RPAD(IFNULL(CAST(PC.LI7_AGMT_NUMBER AS STRING),' '),16,' '),
RPAD(IFNULL(CAST(PC.LI7_AGMT_STATE_CODE AS STRING),' '),2,' '),
LPAD(IFNULL(FORMAT("%.*f",2,CAST(PC.LI7_LINE_ITEM_AMOUNT AS FLOAT64) + .0001),RPAD('',10,' ')),10,'0'),
RPAD(IFNULL(CAST(PC.LI8_AGMT_SOURCE_SYSTEM AS STRING),' '),9,' '),
RPAD(IFNULL(CAST(PC.LI8_COMPANY_ID AS STRING),' '),6,' '),
RPAD(IFNULL(CAST(PC.LI8_PRODUCT_TYPE AS STRING),' '),2,' '),
RPAD(IFNULL(CAST(PC.LI8_POLICY_PREFIX AS STRING),' '),4,' '),
RPAD(IFNULL(CAST(PC.LI8_AGMT_NUMBER AS STRING),' '),16,' '),
RPAD(IFNULL(CAST(PC.LI8_AGMT_STATE_CODE AS STRING),' '),2,' '),
LPAD(IFNULL(FORMAT("%.*f",2,CAST(PC.LI8_LINE_ITEM_AMOUNT AS FLOAT64) + .0001),RPAD('',10,' ')),10,'0'),
RPAD(IFNULL(CAST(PC.LI9_AGMT_SOURCE_SYSTEM AS STRING),' '),9,' '),
RPAD(IFNULL(CAST(PC.LI9_COMPANY_ID AS STRING),' '),6,' '),
RPAD(IFNULL(CAST(PC.LI9_PRODUCT_TYPE AS STRING),' '),2,' '),
RPAD(IFNULL(CAST(PC.LI9_POLICY_PREFIX AS STRING),' '),4,' '),
RPAD(IFNULL(CAST(PC.LI9_AGMT_NUMBER AS STRING),' '),16,' '),
RPAD(IFNULL(CAST(PC.LI9_AGMT_STATE_CODE AS STRING),' '),2,' '),
LPAD(IFNULL(FORMAT("%.*f",2,CAST(PC.LI9_LINE_ITEM_AMOUNT AS FLOAT64) + .0001),RPAD('',10,' ')),10,'0'),
RPAD(IFNULL(CAST(PC.LI10_AGMT_SOURCE_SYSTEM AS STRING),' '),9,' '),
RPAD(IFNULL(CAST(PC.LI10_COMPANY_ID AS STRING),' '),6,' '),
RPAD(IFNULL(CAST(PC.LI10_PRODUCT_TYPE AS STRING),' '),2,' '),
RPAD(IFNULL(CAST(PC.LI10_POLICY_PREFIX AS STRING),' '),4,' '),
RPAD(IFNULL(CAST(PC.LI10_AGMT_NUMBER AS STRING),' '),16,' '),
RPAD(IFNULL(CAST(PC.LI10_AGMT_STATE_CODE AS STRING),' '),2,' '),
LPAD(IFNULL(FORMAT("%.*f",2,CAST(PC.LI10_LINE_ITEM_AMOUNT AS FLOAT64) + .0001),RPAD('',10,' ')),10,'0')) AS PC_FEED_STRING
 from OPERATIONAL.STAGE_POS_INSURANCE_PAYMENTS PC where 
 TRANSACTION_DATE =cast(FORMAT_DATE('%Y%m%d',DATE_SUB(CURRENT_DATE('America/Los_Angeles'),INTERVAL 1 DAY)) as int64)
 --CREATE_DTTIME>'{{ prev_execution_date }}'
 union all
SELECT 3 as RECORD_ORDER,CONCAT('TRL',LPAD(CAST(RECORD_CTL AS STRING),6,'0'),LPAD(IFNULL(FORMAT("%.*f",2,CAST(TRANS_AMT AS FLOAT64) + .0001),RPAD('',12,' ')),12,'0')) AS PC_STRING
 from
 (select COUNT(1) RECORD_CTL,CAST(SUM(ROUND(TRANSACTION_TOTAL_AMOUNT,2)) AS STRING) AS TRANS_AMT
 FROM OPERATIONAL.STAGE_POS_INSURANCE_PAYMENTS where 
 TRANSACTION_DATE =cast(FORMAT_DATE('%Y%m%d',DATE_SUB(CURRENT_DATE('America/Los_Angeles'),INTERVAL 1 DAY)) as int64)
 --CREATE_DTTIME>'{{ prev_execution_date }}'
 ))
 order by RECORD_IDENTIFIER asc
