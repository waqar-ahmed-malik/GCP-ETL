MERGE CUSTOMERS.INS_PERSON_CONTACT_DETAIL A
USING (SELECT * FROM (
SELECT EVENT_ID,
ENTERPRISE_ID,
CURRENT_FLAG,
SALUTATION,
NAME_PREFIX,
FIRST_NAME,
MIDDLE_NAME,
LAST_NAME,
NAME_SUFFIX,
PREFERRED_NAME,
GENDER,
EMPLOYEE_FLAG,
MARITAL_STATUS,
BIRTH_YEAR,
PREFERRED_LANGUAGE,
DATE_OF_BIRTH,
DATE_OF_DEATH,
MEMBERSHIP_START_DATE,
MEMBERSHIP_INCEPTION_DATE,
STREET_LINE1,
STREET_LINE2,
STREET_LINE3,
STREET_LINE4,
PRE_STREET_DIRECTION,
STREET_NAME,
POST_STREET_DIRECTION,
STREET_SUFFIX,
PO_BOX_NUMBER,
BUILDING_NAME,
UNIT_NUMBER,
FLOOR_NUMBER,
HOUSE_NUMBER,
CITY,
STATE,
SUBREGION,
ZIPCODE,
COUNTRY,
LATTITUDE,
LONGITUDE,
ADDR_DO_NOT_CONTACT,
ADDR_DO_NOT_SOLICIT,
PHONE_COUNTRY_CODE,
PHONE_AREA_CODE,
PHONE_NUMBER,
PHONE_EXTENSION,
FAX_INDICATOR,
PHONE_DO_NOT_CALL,
PHONE_DO_NOT_CONTACT,
PHONE_DO_NOT_SOLICIT,
PHONE_STATUS,
EMAIL_ADDRESS,
EMAIL_DO_NOT_CONTACT,
EMAIL_DO_NOT_SOLICIT,
EMAIL_STATUS,
SEQUENCE_NUMBER,
LOAD_DATE,
UPDATE_DATE,
ROW_NUMBER() OVER(PARTITION BY ENTERPRISE_ID ORDER BY PARSE_DATE('%m/%d/%Y',SUBSTR(UPDATE_DATE,1,10))) AS RNK
FROM
LANDING.INS_PERSON_CONTACT_DETAIL) 
WHERE RNK=1) B
ON A.ENTERPRISE_ID = B.ENTERPRISE_ID
WHEN MATCHED THEN
UPDATE SET
A.EVENT_ID=B.EVENT_ID,					
A.CURRENT_FLAG=B.CURRENT_FLAG,			
A.SALUTATION=B.SALUTATION,
A.NAME_PREFIX=B.NAME_PREFIX,			
A.FIRST_NAME=B.FIRST_NAME,			
A.MIDDLE_NAME=B.MIDDLE_NAME,			
A.LAST_NAME=B.LAST_NAME,			
A.NAME_SUFFIX=B.NAME_SUFFIX,			
A.PREFERRED_NAME=B.PREFERRED_NAME,			
A.GENDER=B.GENDER,			
A.EMPLOYEE_FLAG=B.EMPLOYEE_FLAG,			
A.MARITAL_STATUS=B.MARITAL_STATUS,			
A.BIRTH_YEAR=B.BIRTH_YEAR,			
A.PREFERRED_LANGUAGE=B.PREFERRED_LANGUAGE,			
A.DATE_OF_BIRTH=B.DATE_OF_BIRTH,		
A.DATE_OF_DEATH=B.DATE_OF_DEATH,			
A.MEMBERSHIP_START_DATE=B.MEMBERSHIP_START_DATE,			
A.MEMBERSHIP_INCEPTION_DATE=B.MEMBERSHIP_INCEPTION_DATE,		
A.STREET_LINE1=B.STREET_LINE1,			
A.STREET_LINE2=B.STREET_LINE2,			
A.STREET_LINE3=B.STREET_LINE3,			
A.STREET_LINE4=B.STREET_LINE4,			
A.PRE_STREET_DIRECTION=B.PRE_STREET_DIRECTION,			
A.STREET_NAME=B.STREET_NAME,		
A.POST_STREET_DIRECTION=B.POST_STREET_DIRECTION,			
A.STREET_SUFFIX=B.STREET_SUFFIX,			
A.PO_BOX_NUMBER=B.PO_BOX_NUMBER,			
A.BUILDING_NAME=B.BUILDING_NAME,			
A.UNIT_NUMBER=B.UNIT_NUMBER,		
A.FLOOR_NUMBER=B.FLOOR_NUMBER,			
A.HOUSE_NUMBER=B.HOUSE_NUMBER,			
A.CITY=B.CITY,			
A.STATE=B.STATE,			
A.SUBREGION=B.SUBREGION,		
A.ZIPCODE=B.ZIPCODE,			
A.COUNTRY=B.COUNTRY,			
A.LATTITUDE=B.LATTITUDE,			
A.LONGITUDE=B.LONGITUDE,			
A.ADDR_DO_NOT_CONTACT=B.ADDR_DO_NOT_CONTACT,			
A.ADDR_DO_NOT_SOLICIT=B.ADDR_DO_NOT_SOLICIT,			
A.PHONE_COUNTRY_CODE=B.PHONE_COUNTRY_CODE,			
A.PHONE_AREA_CODE=B.PHONE_AREA_CODE,			
A.PHONE_NUMBER=B.PHONE_NUMBER,			
A.PHONE_EXTENSION=B.PHONE_EXTENSION,			
A.FAX_INDICATOR=B.FAX_INDICATOR,			
A.PHONE_DO_NOT_CALL=B.PHONE_DO_NOT_CALL,			
A.PHONE_DO_NOT_CONTACT=B.PHONE_DO_NOT_CONTACT,			
A.PHONE_DO_NOT_SOLICIT=B.PHONE_DO_NOT_SOLICIT,			
A.PHONE_STATUS=B.PHONE_STATUS,			
A.EMAIL_ADDRESS=B.EMAIL_ADDRESS,		
A.EMAIL_DO_NOT_CONTACT=B.EMAIL_DO_NOT_CONTACT,			
A.EMAIL_DO_NOT_SOLICIT=B.EMAIL_DO_NOT_SOLICIT,			
A.EMAIL_STATUS=B.EMAIL_STATUS,			
A.SEQUENCE_NUMBER=B.SEQUENCE_NUMBER,			
A.LOAD_DATE=B.LOAD_DATE,			
A.UPDATE_DATE=B.UPDATE_DATE	
WHEN NOT MATCHED THEN
  INSERT (EVENT_ID,			
ENTERPRISE_ID,			
CURRENT_FLAG,			
SALUTATION,			
NAME_PREFIX,			
FIRST_NAME,			
MIDDLE_NAME,			
LAST_NAME,			
NAME_SUFFIX,			
PREFERRED_NAME,			
GENDER,			
EMPLOYEE_FLAG,			
MARITAL_STATUS,			
BIRTH_YEAR,			
PREFERRED_LANGUAGE,			
DATE_OF_BIRTH,			
DATE_OF_DEATH,			
MEMBERSHIP_START_DATE,			
MEMBERSHIP_INCEPTION_DATE,			
STREET_LINE1,			
STREET_LINE2,			
STREET_LINE3,			
STREET_LINE4,			
PRE_STREET_DIRECTION,			
STREET_NAME,		
POST_STREET_DIRECTION,			
STREET_SUFFIX,			
PO_BOX_NUMBER,			
BUILDING_NAME,			
UNIT_NUMBER,			
FLOOR_NUMBER,			
HOUSE_NUMBER,			
CITY,			
STATE,			
SUBREGION,			
ZIPCODE,			
COUNTRY,			
LATTITUDE,			
LONGITUDE,			
ADDR_DO_NOT_CONTACT,			
ADDR_DO_NOT_SOLICIT,			
PHONE_COUNTRY_CODE,			
PHONE_AREA_CODE,			
PHONE_NUMBER,			
PHONE_EXTENSION,			
FAX_INDICATOR,			
PHONE_DO_NOT_CALL,			
PHONE_DO_NOT_CONTACT,			
PHONE_DO_NOT_SOLICIT,			
PHONE_STATUS,			
EMAIL_ADDRESS,			
EMAIL_DO_NOT_CONTACT,			
EMAIL_DO_NOT_SOLICIT,			
EMAIL_STATUS,			
SEQUENCE_NUMBER,		
LOAD_DATE,			
UPDATE_DATE) VALUES(EVENT_ID,			
ENTERPRISE_ID,			
CURRENT_FLAG,			
SALUTATION,			
NAME_PREFIX,			
FIRST_NAME,			
MIDDLE_NAME,			
LAST_NAME,			
NAME_SUFFIX,			
PREFERRED_NAME,			
GENDER,			
EMPLOYEE_FLAG,			
MARITAL_STATUS,			
BIRTH_YEAR,			
PREFERRED_LANGUAGE,			
DATE_OF_BIRTH,			
DATE_OF_DEATH,			
MEMBERSHIP_START_DATE,			
MEMBERSHIP_INCEPTION_DATE,			
STREET_LINE1,			
STREET_LINE2,			
STREET_LINE3,			
STREET_LINE4,			
PRE_STREET_DIRECTION,			
STREET_NAME,		
POST_STREET_DIRECTION,			
STREET_SUFFIX,			
PO_BOX_NUMBER,			
BUILDING_NAME,			
UNIT_NUMBER,			
FLOOR_NUMBER,			
HOUSE_NUMBER,			
CITY,			
STATE,			
SUBREGION,			
ZIPCODE,			
COUNTRY,			
LATTITUDE,			
LONGITUDE,			
ADDR_DO_NOT_CONTACT,			
ADDR_DO_NOT_SOLICIT,			
PHONE_COUNTRY_CODE,			
PHONE_AREA_CODE,			
PHONE_NUMBER,			
PHONE_EXTENSION,			
FAX_INDICATOR,			
PHONE_DO_NOT_CALL,			
PHONE_DO_NOT_CONTACT,			
PHONE_DO_NOT_SOLICIT,			
PHONE_STATUS,			
EMAIL_ADDRESS,			
EMAIL_DO_NOT_CONTACT,			
EMAIL_DO_NOT_SOLICIT,			
EMAIL_STATUS,			
SEQUENCE_NUMBER,		
LOAD_DATE,			
UPDATE_DATE);