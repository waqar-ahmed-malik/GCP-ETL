
MERGE OPERATIONAL.GLOBALWARE_SEGMENTS A
USING LANDING.WORK_GW_SEGMENTS  B
ON CONCAT(SAFE_CAST(A.INV_PAY_ID AS STRING),SAFE_CAST(A.SEGEMTN_NUM AS STRING)) = CONCAT(SAFE_CAST(B.INV_PAY_ID AS STRING),SAFE_CAST(B.SEGEMTN_NUM AS STRING))
WHEN MATCHED THEN
UPDATE SET
A.AIRLINE  = B.AIRLINE ,
A.FLIGHT  = B.FLIGHT ,
A.CLASS  = B.CLASS ,
A.DEPART_CITY  = B.DEPART_CITY ,
A.ARRIVAL_CITY  = B.ARRIVAL_CITY ,
A.DEPART_DT  = PARSE_DATE("%Y-%m-%d",SUBSTR(B.DEPART_DT ,0,10) ),
A.ARRIVAL_DT  = PARSE_DATE("%Y-%m-%d",SUBSTR(B.ARRIVAL_DT ,0,10) ) ,
A.DEPART_TM  = B.DEPART_TM ,
A.ARRIVAL_TM  = B.ARRIVAL_TM ,
A.FARE_BASIS  =B.FARE_BASIS ,
A.FARE  =  SAFE_CAST(B.FARE AS FLOAT64),
A.SEGMENTS_CONNECT  = B.SEGMENTS_CONNECT ,
A.STATUS  = B.STATUS ,
A.ACCOUNT_ID  = B.ACCOUNT_ID ,
A.DOM_INT  = B.DOM_INT ,
A.MEAL_CD  = B.MEAL_CD ,
A.TICKET_DESIGNATOR  = B.TICKET_DESIGNATOR ,
A.FREQ_FLYER_NUM  = B.FREQ_FLYER_NUM ,
A.FREQ_FLYER_MILES  = B.FREQ_FLYER_MILES ,
A.NAUTICAL_MILES  = B.NAUTICAL_MILES ,
A.DEST_STOP_OVER  = B.DEST_STOP_OVER ,
A.TRUE_OD_NUM  = B.TRUE_OD_NUM ,
A.FREQ_FLYER_CARRIER  = B.FREQ_FLYER_CARRIER ,
A.OP_AIRLINE  = B.OP_AIRLINE ,
A.OP_AIRLINE_NM = B.OP_AIRLINE_NM


WHEN NOT MATCHED THEN
  INSERT (
INV_PAY_ID,
SEGEMTN_NUM,
AIRLINE,
FLIGHT,
CLASS,
DEPART_CITY,
ARRIVAL_CITY,
DEPART_DT,
ARRIVAL_DT,
DEPART_TM,
ARRIVAL_TM,
FARE_BASIS,
FARE,
SEGMENTS_CONNECT,
STATUS,
ACCOUNT_ID,
DOM_INT,
MEAL_CD,
TICKET_DESIGNATOR,
FREQ_FLYER_NUM,
FREQ_FLYER_MILES,
NAUTICAL_MILES,
DEST_STOP_OVER,
TRUE_OD_NUM,
FREQ_FLYER_CARRIER,
OP_AIRLINE,
OP_AIRLINE_NM,
JOB_RUN_ID,
SOURCE_SYSTEM_CD,
CREATE_DT
)
VALUES(
 SAFE_CAST(INV_PAY_ID AS INT64),
 SAFE_CAST(SEGEMTN_NUM AS INT64),
AIRLINE,
FLIGHT,
CLASS,
DEPART_CITY,
ARRIVAL_CITY,
PARSE_DATE("%Y-%m-%d",SUBSTR(DEPART_DT,0,10) ),
PARSE_DATE("%Y-%m-%d",SUBSTR(ARRIVAL_DT ,0,10) ),
DEPART_TM,
ARRIVAL_TM,
FARE_BASIS,
 SAFE_CAST(FARE AS FLOAT64),
SEGMENTS_CONNECT,
STATUS,
ACCOUNT_ID,
DOM_INT,
MEAL_CD,
TICKET_DESIGNATOR,
FREQ_FLYER_NUM,
FREQ_FLYER_MILES,
NAUTICAL_MILES,
DEST_STOP_OVER,
TRUE_OD_NUM,
FREQ_FLYER_CARRIER,
OP_AIRLINE,
OP_AIRLINE_NM,
"jobrunid",
'GLOBALWARE' ,
CURRENT_DATE());


