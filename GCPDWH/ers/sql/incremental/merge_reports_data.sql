MERGE OPERATIONAL.ERS_STAGE_REPORTS_DATA AS TGT
USING (SELECT DISTINCT * FROM LANDING.WORK_ERS_STG_REPORTS_DATA) AS SRC
ON TGT.COMM_CTR_ID = SRC.COMM_CTR_ID AND
TGT.SC_DT = SAFE_CAST(SRC.SC_DT AS DATETIME) AND
SAFE_CAST(TGT.SC_ID AS STRING) = SRC.SC_ID
WHEN MATCHED
THEN UPDATE SET
TGT.ARCH_DATETIME = SAFE_CAST(SRC.ARCH_DATE AS DATETIME) , 
TGT.CALL_MBR_ID = SRC.CALL_MBR_ID , 
TGT.CALL_SOURCE = SRC.CALL_SOURCE , 
TGT.RE_TM = SAFE_CAST(SRC.RE_TM AS DATETIME) , 
TGT.RE_EMPLE_ID = SRC.RE_EMPLE_ID , 
TGT.FST_SP_TM = SAFE_CAST(SRC.FST_SP_TM AS DATETIME), 
TGT.FST_SP_EMPLE_ID = SRC.FST_SP_EMPLE_ID , 
TGT.FST_SP_STS_RSN_CD = SRC.FST_SP_STS_RSN_CD , 
TGT.FST_AS_TM = SAFE_CAST(SRC.FST_AS_TM AS DATETIME) , 
TGT.FST_AS_EMPLE_ID = SRC.FST_AS_EMPLE_ID , 
TGT.FST_AS_STS_RSN_CD = SRC.FST_AS_STS_RSN_CD , 
TGT.FST_DI_TM = SAFE_CAST(SRC.FST_DI_TM AS DATETIME), 
TGT.FST_DI_EMPLE_ID = SRC.FST_DI_EMPLE_ID , 
TGT.FST_DI_STS_RSN_CD = SRC.FST_DI_STS_RSN_CD , 
TGT.FST_ER_TM = SAFE_CAST(SRC.FST_ER_TM AS DATETIME), 
TGT.FST_ER_EMPLE_ID = SRC.FST_ER_EMPLE_ID , 
TGT.FST_ER_STS_RSN_CD = SRC.FST_ER_STS_RSN_CD , 
TGT.FST_OL_TM = SAFE_CAST(SRC.FST_OL_TM AS DATETIME) , 
TGT.FST_OL_EMPLE_ID = SRC.FST_OL_EMPLE_ID , 
TGT.FST_OL_STS_RSN_CD = SRC.FST_OL_STS_RSN_CD , 
TGT.FST_TW_TM = SAFE_CAST(SRC.FST_TW_TM AS DATETIME) , 
TGT.FST_TW_EMPLE_ID = SRC.FST_TW_EMPLE_ID , 
TGT.FST_TW_STS_RSN_CD = SRC.FST_TW_STS_RSN_CD , 
TGT.FST_CL_TM = SAFE_CAST(SRC.FST_CL_TM AS DATETIME) , 
TGT.FST_CL_EMPLE_ID = SRC.FST_CL_EMPLE_ID , 
TGT.FST_CL_STS_RSN_CD = SRC.FST_CL_STS_RSN_CD , 
TGT.LST_SP_TM = SAFE_CAST(SRC.LST_SP_TM AS DATETIME), 
TGT.LST_SP_EMPLE_ID = SRC.LST_SP_EMPLE_ID , 
TGT.LST_SP_STS_RSN_CD = SRC.LST_SP_STS_RSN_CD , 
TGT.LST_AS_TM = SAFE_CAST(SRC.LST_AS_TM AS DATETIME) , 
TGT.LST_AS_EMPLE_ID = SRC.LST_AS_EMPLE_ID , 
TGT.LST_AS_STS_RSN_CD = SRC.LST_AS_STS_RSN_CD , 
TGT.LST_DI_TM = SAFE_CAST(SRC.LST_DI_TM AS DATETIME) , 
TGT.LST_DI_EMPLE_ID = SRC.LST_DI_EMPLE_ID , 
TGT.LST_DI_STS_RSN_CD = SRC.LST_DI_STS_RSN_CD , 
TGT.LST_OL_TM = SAFE_CAST(SRC.LST_OL_TM AS DATETIME), 
TGT.LST_OL_EMPLE_ID = SRC.LST_OL_EMPLE_ID , 
TGT.LST_OL_STS_RSN_CD = SRC.LST_OL_STS_RSN_CD , 
TGT.UP1_TM = SAFE_CAST(SRC.UP1_TM AS DATETIME), 
TGT.UP1_STS_CD = SRC.UP1_STS_CD , 
TGT.UP1_STS_RSN_CD = SRC.UP1_STS_RSN_CD , 
TGT.UP1_EMPLE_ID = SRC.UP1_EMPLE_ID , 
TGT.UP2_TM = SAFE_CAST(SRC.UP2_TM AS DATETIME) , 
TGT.UP2_STS_CD = SRC.UP2_STS_CD , 
TGT.UP2_STS_RSN_CD = SRC.UP2_STS_RSN_CD , 
TGT.UP2_EMPLE_ID = SRC.UP2_EMPLE_ID , 
TGT.UP3_TM = SAFE_CAST(SRC.UP3_TM AS DATETIME) , 
TGT.UP3_STS_CD = SRC.UP3_STS_CD , 
TGT.UP3_STS_RSN_CD = SRC.UP3_STS_RSN_CD , 
TGT.UP3_EMPLE_ID = SRC.UP3_EMPLE_ID , 
TGT.UP4_TM = SAFE_CAST(SRC.UP4_TM AS DATETIME), 
TGT.UP4_STS_CD = SRC.UP4_STS_CD , 
TGT.UP4_STS_RSN_CD = SRC.UP4_STS_RSN_CD , 
TGT.UP4_EMPLE_ID = SRC.UP4_EMPLE_ID , 
TGT.UP5_TM = SAFE_CAST(SRC.UP5_TM AS DATETIME) , 
TGT.UP5_STS_CD = SRC.UP5_STS_CD , 
TGT.UP5_STS_RSN_CD = SRC.UP5_STS_RSN_CD , 
TGT.UP5_EMPLE_ID = SRC.UP5_EMPLE_ID , 
TGT.FIRST_FACL_ID = SRC.FIRST_FACL_ID , 
TGT.FIRST_FACIL_INT_ID = SAFE_CAST(SRC.FIRST_FACIL_INT_ID AS INT64), 
TGT.LAST_FACL_ID = SRC.LAST_FACL_ID , 
TGT.LAST_FACIL_INT_ID = SAFE_CAST(SRC.LAST_FACIL_INT_ID AS INT64) , 
TGT.SC_A_SVC_TRK_ID = SRC.SC_A_SVC_TRK_ID , 
TGT.SC_A_SVC_TRK_D_ID = SRC.SC_A_SVC_TRK_D_ID , 
TGT.SC_PRMS_ARR_TM = SAFE_CAST(SRC.SC_PRMS_ARR_TM AS DATETIME) , 
TGT.CALL_COST = SAFE_CAST(SRC.CALL_COST AS FLOAT64), 
TGT.PROB1_CD = SRC.PROB1_CD , 
TGT.PROB2_CD = SRC.PROB2_CD , 
TGT.PLUS_IND = SRC.PLUS_IND , 
TGT.RAP_INDIC = SRC.RAP_INDIC , 
TGT.RAP_PROGRAM_ID = SRC.RAP_PROGRAM_ID , 
TGT.PTA_FST_OL_VAR = SRC.PTA_FST_OL_VAR , 
TGT.REASGN_RSN_CD = SRC.REASGN_RSN_CD , 
TGT.LOST_FACL_ID = SRC.LOST_FACL_ID , 
TGT.CALLOUT_CNT_DISPATCHER = SAFE_CAST(SRC.CALLOUT_CNT_DISPATCHER AS INT64) , 
TGT.CALLOUT_CNT_CALLOUTBOX = SAFE_CAST( SRC.CALLOUT_CNT_CALLOUTBOX AS INT64) , 
TGT.CALLOUT_INITIAL_ETA_RESULT = SRC.CALLOUT_INITIAL_ETA_RESULT , 
TGT.CALLOUT_CONFIRM_RESULT = SRC.CALLOUT_CONFIRM_RESULT , 
TGT.CALLOUTBOX1_RESULT = SRC.CALLOUTBOX1_RESULT , 
TGT.CALLOUTBOX2_RESULT = SRC.CALLOUTBOX2_RESULT , 
TGT.CALLOUTBOX3_RESULT = SRC.CALLOUTBOX3_RESULT , 
TGT.LST_CL_STS_RSN_CD = SRC.LST_CL_STS_RSN_CD , 
TGT.LST_CL_EMPLE_ID = SRC.LST_CL_EMPLE_ID , 
TGT.LST_CL_TM = SAFE_CAST(SRC.LST_CL_TM AS DATETIME) , 
TGT.ETL_JOB_RUN_ID = SAFE_CAST(SRC.JOB_RUN_ID AS INT64) , 
TGT.SOURCE_SYSTEM_CD = SRC.SOURCE_SYSTEM_CD ,  
TGT.CREATE_DTTIME = current_datetime() ,
TGT.CREATE_BY = SRC.CREATED_BY 

WHEN NOT MATCHED THEN INSERT 
(
COMM_CTR_ID , 
SC_DT , 
SC_ID , 
ARCH_DATETIME , 
CALL_MBR_ID , 
CALL_SOURCE , 
RE_TM , 
RE_EMPLE_ID , 
FST_SP_TM , 
FST_SP_EMPLE_ID , 
FST_SP_STS_RSN_CD , 
FST_AS_TM , 
FST_AS_EMPLE_ID , 
FST_AS_STS_RSN_CD , 
FST_DI_TM , 
FST_DI_EMPLE_ID , 
FST_DI_STS_RSN_CD , 
FST_ER_TM , 
FST_ER_EMPLE_ID , 
FST_ER_STS_RSN_CD , 
FST_OL_TM , 
FST_OL_EMPLE_ID , 
FST_OL_STS_RSN_CD , 
FST_TW_TM , 
FST_TW_EMPLE_ID , 
FST_TW_STS_RSN_CD , 
FST_CL_TM , 
FST_CL_EMPLE_ID , 
FST_CL_STS_RSN_CD , 
LST_SP_TM , 
LST_SP_EMPLE_ID , 
LST_SP_STS_RSN_CD , 
LST_AS_TM , 
LST_AS_EMPLE_ID , 
LST_AS_STS_RSN_CD , 
LST_DI_TM , 
LST_DI_EMPLE_ID , 
LST_DI_STS_RSN_CD , 
LST_OL_TM , 
LST_OL_EMPLE_ID , 
LST_OL_STS_RSN_CD , 
UP1_TM , 
UP1_STS_CD , 
UP1_STS_RSN_CD , 
UP1_EMPLE_ID , 
UP2_TM , 
UP2_STS_CD , 
UP2_STS_RSN_CD , 
UP2_EMPLE_ID , 
UP3_TM , 
UP3_STS_CD , 
UP3_STS_RSN_CD , 
UP3_EMPLE_ID , 
UP4_TM , 
UP4_STS_CD , 
UP4_STS_RSN_CD , 
UP4_EMPLE_ID , 
UP5_TM , 
UP5_STS_CD , 
UP5_STS_RSN_CD , 
UP5_EMPLE_ID , 
FIRST_FACL_ID , 
FIRST_FACIL_INT_ID , 
LAST_FACL_ID , 
LAST_FACIL_INT_ID , 
SC_A_SVC_TRK_ID , 
SC_A_SVC_TRK_D_ID , 
SC_PRMS_ARR_TM , 
CALL_COST , 
PROB1_CD , 
PROB2_CD , 
PLUS_IND , 
RAP_INDIC , 
RAP_PROGRAM_ID , 
PTA_FST_OL_VAR , 
REASGN_RSN_CD , 
LOST_FACL_ID , 
CALLOUT_CNT_DISPATCHER , 
CALLOUT_CNT_CALLOUTBOX , 
CALLOUT_INITIAL_ETA_RESULT , 
CALLOUT_CONFIRM_RESULT , 
CALLOUTBOX1_RESULT , 
CALLOUTBOX2_RESULT , 
CALLOUTBOX3_RESULT , 
LST_CL_STS_RSN_CD , 
LST_CL_EMPLE_ID , 
LST_CL_TM , 
ETL_JOB_RUN_ID , 
SOURCE_SYSTEM_CD , 
CREATE_DTTIME , 
CREATE_BY )

VALUES

(
SRC.COMM_CTR_ID ,
SAFE_CAST(SRC.SC_DT AS DATETIME),
SAFE_CAST(SRC.SC_ID AS INT64) ,
SAFE_CAST(SRC.ARCH_DATE AS DATETIME) ,
SRC.CALL_MBR_ID ,
SRC.CALL_SOURCE ,
SAFE_CAST(SRC.RE_TM AS DATETIME) ,
SRC.RE_EMPLE_ID ,
SAFE_CAST(SRC.FST_SP_TM AS DATETIME),
SRC.FST_SP_EMPLE_ID ,
SRC.FST_SP_STS_RSN_CD ,
SAFE_CAST(SRC.FST_AS_TM AS DATETIME) ,
SRC.FST_AS_EMPLE_ID ,
SRC.FST_AS_STS_RSN_CD ,
SAFE_CAST(SRC.FST_DI_TM AS DATETIME),
SRC.FST_DI_EMPLE_ID ,
SRC.FST_DI_STS_RSN_CD ,
SAFE_CAST(SRC.FST_ER_TM AS DATETIME),
SRC.FST_ER_EMPLE_ID ,
SRC.FST_ER_STS_RSN_CD ,
SAFE_CAST(SRC.FST_OL_TM AS DATETIME) ,
SRC.FST_OL_EMPLE_ID ,
SRC.FST_OL_STS_RSN_CD ,
SAFE_CAST(SRC.FST_TW_TM AS DATETIME) ,
SRC.FST_TW_EMPLE_ID ,
SRC.FST_TW_STS_RSN_CD ,
SAFE_CAST(SRC.FST_CL_TM AS DATETIME) ,
SRC.FST_CL_EMPLE_ID ,
SRC.FST_CL_STS_RSN_CD ,
SAFE_CAST(SRC.LST_SP_TM AS DATETIME),
SRC.LST_SP_EMPLE_ID ,
SRC.LST_SP_STS_RSN_CD ,
SAFE_CAST(SRC.LST_AS_TM AS DATETIME) ,
SRC.LST_AS_EMPLE_ID ,
SRC.LST_AS_STS_RSN_CD ,
SAFE_CAST(SRC.LST_DI_TM AS DATETIME) ,
SRC.LST_DI_EMPLE_ID ,
SRC.LST_DI_STS_RSN_CD ,
SAFE_CAST(SRC.LST_OL_TM AS DATETIME),
SRC.LST_OL_EMPLE_ID ,
SRC.LST_OL_STS_RSN_CD ,
SAFE_CAST(SRC.UP1_TM AS DATETIME),
SRC.UP1_STS_CD ,
SRC.UP1_STS_RSN_CD ,
SRC.UP1_EMPLE_ID ,
SAFE_CAST(SRC.UP2_TM AS DATETIME) ,
SRC.UP2_STS_CD ,
SRC.UP2_STS_RSN_CD ,
SRC.UP2_EMPLE_ID ,
SAFE_CAST(SRC.UP3_TM AS DATETIME) ,
SRC.UP3_STS_CD ,
SRC.UP3_STS_RSN_CD ,
SRC.UP3_EMPLE_ID ,
SAFE_CAST(SRC.UP4_TM AS DATETIME),
SRC.UP4_STS_CD ,
SRC.UP4_STS_RSN_CD ,
SRC.UP4_EMPLE_ID ,
SAFE_CAST(SRC.UP5_TM AS DATETIME) ,
SRC.UP5_STS_CD ,
SRC.UP5_STS_RSN_CD ,
SRC.UP5_EMPLE_ID ,
SRC.FIRST_FACL_ID ,
SAFE_CAST(SRC.FIRST_FACIL_INT_ID AS INT64),
SRC.LAST_FACL_ID ,
SAFE_CAST(SRC.LAST_FACIL_INT_ID AS INT64) ,
SRC.SC_A_SVC_TRK_ID ,
SRC.SC_A_SVC_TRK_D_ID ,
SAFE_CAST(SRC.SC_PRMS_ARR_TM AS DATETIME) ,
SAFE_CAST(SRC.CALL_COST AS FLOAT64),
SRC.PROB1_CD ,
SRC.PROB2_CD ,
SRC.PLUS_IND ,
SRC.RAP_INDIC ,
SRC.RAP_PROGRAM_ID ,
SRC.PTA_FST_OL_VAR ,
SRC.REASGN_RSN_CD ,
SRC.LOST_FACL_ID ,
SAFE_CAST(SRC.CALLOUT_CNT_DISPATCHER AS INT64),
SAFE_CAST(SRC.CALLOUT_CNT_CALLOUTBOX AS INT64),
SRC.CALLOUT_INITIAL_ETA_RESULT ,
SRC.CALLOUT_CONFIRM_RESULT ,
SRC.CALLOUTBOX1_RESULT ,
SRC.CALLOUTBOX2_RESULT ,
SRC.CALLOUTBOX3_RESULT ,
SRC.LST_CL_STS_RSN_CD ,
SRC.LST_CL_EMPLE_ID ,
SAFE_CAST(SRC.LST_CL_TM AS DATETIME) ,
SAFE_CAST(SRC.JOB_RUN_ID AS INT64) , 
SRC.SOURCE_SYSTEM_CD , 
current_datetime(),
SRC.CREATED_BY )