-- UPDATE(MERGE)

--MERGE <target_table> [AS TARGET]
--USING <table_source> [AS SOURCE]
--ON <search_condition>
--[WHEN MATCHED 
--THEN <merge_matched> ]
--[WHEN NOT MATCHED [BY TARGET]
--THEN <merge_not_matched> ]
--[WHEN NOT MATCHED BY SOURCE
--THEN <merge_matched> ];
  
--ERS_STAGE_CAD_SVC_VEHICLE
--WORK_ERS_STG_CAD_SVC_VEHICLE
MERGE OPERATIONAL.ERS_STAGE_CAD_SVC_VEHICLE AS TGT
USING (SELECT DISTINCT * FROM  LANDING.WORK_ERS_STG_CAD_SVC_VEHICLE) AS SRC
ON TGT.SC_DT = CAST(SRC.SC_DT AS DATETIME) and
CAST(TGT.SC_ID AS STRING) = SRC.SC_ID and
CAST(TGT.SC_VEH_SEQ_ID AS STRING)= SRC.SC_VEH_SEQ_ID
WHEN MATCHED
THEN UPDATE SET
TGT.SC_DT = CAST(SRC.SC_DT AS DATETIME) , 
TGT.SC_ID = CAST(SRC.SC_ID AS INT64), 
TGT.SC_VEH_SEQ_ID = CAST(SRC.SC_VEH_SEQ_ID AS INT64), 
TGT.SC_VEH_LIC_ST_CD = SRC.SC_VEH_LIC_ST_CD, 
TGT.SC_VEH_COLR_NM = SRC.SC_VEH_COLR_NM, 
TGT.SC_VEH_LIC_TAG_NR = SRC.SC_VEH_LIC_TAG_NR, 
TGT.SC_VEH_MANF_YR_DT = SRC.SC_VEH_MANF_YR_DT, 
TGT.SC_VEH_MANFR_NM = SRC.SC_VEH_MANFR_NM, 
TGT.SC_VEH_MDL_NM = SRC.SC_VEH_MDL_NM, 
TGT.LAST_UPDATE = CAST(SRC.LAST_UPDATE AS DATE),
TGT.SC_VEH_UNSN_CHNG = SRC.SC_VEH_UNSN_CHNG, 
TGT.EMPLE_ID = SRC.EMPLE_ID, 
TGT.FLATBED_INDIC = SRC.FLATBED_INDIC, 
TGT.FOUR_WHEEL_DRIVE = SRC.FOUR_WHEEL_DRIVE, 
TGT.REC_VEHICLE = SRC.REC_VEHICLE, 
TGT.AWD_VEHICLE = SRC.AWD_VEHICLE, 
TGT.MCYCLE_INDIC = SRC.MCYCLE_INDIC, 
TGT.VEHICLE_ID = SRC.VEHICLE_ID, 
TGT.BASE_VEHICLE_ID = SRC.BASE_VEHICLE_ID, 
TGT.VEH_TYPE = SRC.VEH_TYPE, 
TGT.SC_VEH_TRM = SRC.SC_VEH_TRM, 
TGT.TWO_WHEEL_DRIVE = SRC.TWO_WHEEL_DRIVE, 
TGT.DOLLY_INDIC = SRC.DOLLY_INDIC, 
TGT.LOCKSMITH_INDIC = SRC.LOCKSMITH_INDIC, 
TGT.WHEEL_LIFT_REQ_INDIC = SRC.WHEEL_LIFT_REQ_INDIC, 
TGT.WHEEL_LIFT_INDIC = SRC.WHEEL_LIFT_INDIC, 
TGT.MC_TYPE = SRC.MC_TYPE, 
TGT.MC_ENG_TYPE = SRC.MC_ENG_TYPE, 
TGT.MC_COMMENT = SRC.MC_COMMENT, 
TGT.MC_PULLING_TRL = SRC.MC_PULLING_TRL, 
TGT.MC_LAID_DOWN = SRC.MC_LAID_DOWN, 
TGT.MC_WHEELS_ROLL = SRC.MC_WHEELS_ROLL, 
TGT.RV_LENGTH = SRC.RV_LENGTH, 
TGT.RV_HEIGHT = SRC.RV_HEIGHT, 
TGT.RV_GOOSENECK = SRC.RV_GOOSENECK, 
TGT.RV_ENG_LOC = SRC.RV_ENG_LOC, 
TGT.RV_TOWING = SRC.RV_TOWING, 
TGT.RV_TYPE_TOWING = SRC.RV_TYPE_TOWING, 
TGT.FLAT_LOCATION = SRC.FLAT_LOCATION, 
TGT.TRL_INDIC = SRC.TRL_INDIC, 
TGT.TRL_TYPE = SRC.TRL_TYPE, 
TGT.TRL_LENGTH = SRC.TRL_LENGTH, 
TGT.TRL_NO_AXLES = SRC.TRL_NO_AXLES,
TGT.TRL_CONDITION = SRC.TRL_CONDITION, 
TGT.TRL_PLUG_TYPE = SRC.TRL_PLUG_TYPE, 
TGT.TRL_HITCH_TYPE = SRC.TRL_HITCH_TYPE, 
TGT.TRL_HITCH_SIZE = SRC.TRL_HITCH_SIZE, 
TGT.TRL_GOOSENECK = SRC.TRL_GOOSENECK, 
TGT.TRL_LOADED = SRC.TRL_LOADED,
TGT.TRL_LOAD_TYPE = SRC.TRL_LOAD_TYPE, 
TGT.TRL_LOAD_WEIGHT = SRC.TRL_LOAD_WEIGHT, 
TGT.HYBRID_VEHICLE = SRC.HYBRID_VEHICLE, 
TGT.ELECTRIC_VEHICLE = SRC.ELECTRIC_VEHICLE, 
TGT.IS_DIESEL = SRC.IS_DIESEL, 
TGT.AIR_SUSPENSION = SRC.AIR_SUSPENSION,
TGT.SC_VEH_NOTES = SRC.SC_VEH_NOTES, 
TGT.SC_VEH_ODOMETER = CAST(SRC.SC_VEH_ODOMETER AS FLOAT64), 
TGT.SC_VEH_VIN = SRC.SC_VEH_VIN, 
TGT.IS_ONLINE_GARAGE = SRC.IS_ONLINE_GARAGE, 
TGT.PREFERRED_SHOP_ID = SRC.PREFERRED_SHOP_ID, 
TGT.LAST_USED_SHOP_ID = SRC.LAST_USED_SHOP_ID,
TGT.ETL_JOB_RUN_ID = CAST(SRC.JOB_RUN_ID AS INT64), 
TGT.SOURCE_SYSTEM_CD = SRC.SOURCE_SYSTEM_CD ,  
TGT.CREATED_DTTIME = current_datetime() ,
TGT.CREATED_BY = SRC.CREATED_BY
WHEN NOT MATCHED THEN INSERT 
(
SC_DT,
SC_ID,
SC_VEH_SEQ_ID,
SC_VEH_LIC_ST_CD,
SC_VEH_COLR_NM,
SC_VEH_LIC_TAG_NR,
SC_VEH_MANF_YR_DT,
SC_VEH_MANFR_NM,
SC_VEH_MDL_NM,
LAST_UPDATE,
SC_VEH_UNSN_CHNG,
EMPLE_ID,
FLATBED_INDIC,
FOUR_WHEEL_DRIVE,
REC_VEHICLE,
AWD_VEHICLE,
MCYCLE_INDIC,
VEHICLE_ID,
BASE_VEHICLE_ID,
VEH_TYPE,
SC_VEH_TRM,
TWO_WHEEL_DRIVE,
DOLLY_INDIC,
LOCKSMITH_INDIC,
WHEEL_LIFT_REQ_INDIC,
WHEEL_LIFT_INDIC,
MC_TYPE,
MC_ENG_TYPE,
MC_COMMENT,
MC_PULLING_TRL,
MC_LAID_DOWN,
MC_WHEELS_ROLL,
RV_LENGTH,
RV_HEIGHT,
RV_GOOSENECK,
RV_ENG_LOC,
RV_TOWING,
RV_TYPE_TOWING,
FLAT_LOCATION,
TRL_INDIC,
TRL_TYPE,
TRL_LENGTH,
TRL_NO_AXLES,
TRL_CONDITION,
TRL_PLUG_TYPE,
TRL_HITCH_TYPE,
TRL_HITCH_SIZE,
TRL_GOOSENECK,
TRL_LOADED,
TRL_LOAD_TYPE,
TRL_LOAD_WEIGHT,
HYBRID_VEHICLE,
ELECTRIC_VEHICLE,
IS_DIESEL,
AIR_SUSPENSION,
SC_VEH_NOTES,
RV_WEIGHT,
SC_VEH_ODOMETER,
SC_VEH_VIN,
IS_ONLINE_GARAGE,
PREFERRED_SHOP_ID,
LAST_USED_SHOP_ID,
ETL_JOB_RUN_ID,
SOURCE_SYSTEM_CD,
CREATED_BY,
CREATED_DTTIME)
VALUES
(
CAST(SRC.SC_DT AS DATETIME) , 
CAST(SRC.SC_ID AS INT64), 
CAST(SRC.SC_VEH_SEQ_ID AS INT64), 
SRC.SC_VEH_LIC_ST_CD, 
SRC.SC_VEH_COLR_NM, 
SRC.SC_VEH_LIC_TAG_NR, 
SRC.SC_VEH_MANF_YR_DT, 
SRC.SC_VEH_MANFR_NM, 
SRC.SC_VEH_MDL_NM, 
CAST(SRC.LAST_UPDATE AS DATE),
SRC.SC_VEH_UNSN_CHNG, 
SRC.EMPLE_ID, 
SRC.FLATBED_INDIC, 
SRC.FOUR_WHEEL_DRIVE, 
SRC.REC_VEHICLE, 
SRC.AWD_VEHICLE, 
SRC.MCYCLE_INDIC, 
SRC.VEHICLE_ID, 
SRC.BASE_VEHICLE_ID, 
SRC.VEH_TYPE, 
SRC.SC_VEH_TRM, 
SRC.TWO_WHEEL_DRIVE, 
SRC.DOLLY_INDIC, 
SRC.LOCKSMITH_INDIC, 
SRC.WHEEL_LIFT_REQ_INDIC, 
SRC.WHEEL_LIFT_INDIC, 
SRC.MC_TYPE, 
SRC.MC_ENG_TYPE, 
SRC.MC_COMMENT, 
SRC.MC_PULLING_TRL, 
SRC.MC_LAID_DOWN, 
SRC.MC_WHEELS_ROLL, 
SRC.RV_LENGTH, 
SRC.RV_HEIGHT, 
SRC.RV_GOOSENECK, 
SRC.RV_ENG_LOC, 
SRC.RV_TOWING, 
SRC.RV_TYPE_TOWING, 
SRC.FLAT_LOCATION, 
SRC.TRL_INDIC, 
SRC.TRL_TYPE, 
SRC.TRL_LENGTH, 
SRC.TRL_NO_AXLES,
SRC.TRL_CONDITION, 
SRC.TRL_PLUG_TYPE, 
SRC.TRL_HITCH_TYPE, 
SRC.TRL_HITCH_SIZE, 
SRC.TRL_GOOSENECK, 
SRC.TRL_LOADED,
SRC.TRL_LOAD_TYPE, 
SRC.TRL_LOAD_WEIGHT, 
SRC.HYBRID_VEHICLE, 
SRC.ELECTRIC_VEHICLE, 
SRC.IS_DIESEL, 
SRC.AIR_SUSPENSION,
SRC.SC_VEH_NOTES, 
SRC.RV_WEIGHT,
CAST(SRC.SC_VEH_ODOMETER AS FLOAT64), 
SRC.SC_VEH_VIN, 
SRC.IS_ONLINE_GARAGE, 
SRC.PREFERRED_SHOP_ID, 
SRC.LAST_USED_SHOP_ID,
CAST(SRC.JOB_RUN_ID AS INT64),
SOURCE_SYSTEM_CD,
CREATED_BY,
current_datetime()
)

