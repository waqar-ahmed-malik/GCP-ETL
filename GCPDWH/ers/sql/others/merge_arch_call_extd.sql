-- UPDATE(MERGE)

--MERGE <target_table> [AS TARGET]
--USING <table_source> [AS SOURCE]
--ON <search_condition>
--[WHEN MATCHED 
--THEN <merge_matched> ]
--[WHEN NOT MATCHED [BY TARGET]
--THEN <merge_not_matched> ]
--[WHEN NOT MATCHED BY SOURCE
--THEN <merge_matched> ];
  
--ERS_STAGE_ARCH_CALL_EXTD
--WORK_ERS_STG_ARCH_CALL_EXTD
MERGE OPERATIONAL.ERS_STAGE_ARCH_CALL_EXTD AS TGT
USING LANDING.WORK_ERS_STG_ARCH_CALL_EXTD AS SRC
ON TGT.COMM_CTR_ID = SRC.COMM_CTR_ID and
TGT.SC_DT = CAST(SRC.SC_DT AS DATETIME) and
CAST(TGT.SC_ID AS STRING) = SRC.SC_ID
WHEN MATCHED
THEN UPDATE SET
TGT.COMM_CTR_ID = SRC.COMM_CTR_ID , 
TGT.SC_DT = CAST(SRC.SC_DT AS DATETIME) , 
TGT.SC_ID = CAST(SRC.SC_ID AS INT64), 
TGT.EDS_INDIC = SRC.EDS_INDIC , 
TGT.SCOC_INDIC = SRC.SCOC_INDIC , 
TGT.CUC_INDIC = SRC.CUC_INDIC , 
TGT.FLATBED_REQ_INDIC = SRC.FLATBED_REQ_INDIC , 
TGT.USE_THIS_FACL = SRC.USE_THIS_FACL , 
TGT.NOT_THIS_FACL = SRC.NOT_THIS_FACL , 
TGT.BILL_CODE = SRC.BILL_CODE , 
TGT.APT_CALL_INDIC = SRC.APT_CALL_INDIC , 
TGT.TRK_ZONE = SRC.TRK_ZONE , 
TGT.BL_LAT = CAST(SRC.BL_LAT AS FLOAT64) , 
TGT.BL_LONG = CAST(SRC.BL_LONG AS FLOAT64) , 
TGT.TD_LAT = CAST(SRC.TD_LAT AS FLOAT64) , 
TGT.TD_LONG = CAST(SRC.TD_LONG AS FLOAT64) , 
TGT.DRIVER_NAME = SRC.DRIVER_NAME , 
TGT.TOW_DEST_ID = CAST(SRC.TOW_DEST_ID AS INT64) , 
TGT.FLATBED_INDIC = SRC.FLATBED_INDIC , 
TGT.FOUR_WHEEL_DRIVE = SRC.FOUR_WHEEL_DRIVE , 
TGT.REC_VEHICLE = SRC.REC_VEHICLE , 
TGT.AWD_VEHICLE = SRC.AWD_VEHICLE , 
TGT.CASH_CALL_TYPE = SRC.CASH_CALL_TYPE , 
TGT.PO_TRACKING_NUMBER = SRC.PO_TRACKING_NUMBER , 
TGT.CC_NUMBER = SRC.CC_NUMBER , 
TGT.CC_EXPIRE_DATETIME = SRC.CC_EXPIRE_DATE , 
TGT.DISTRICT_NUM = SRC.DISTRICT_NUM , 
TGT.FACL_ONLOC_CHK_DGT = SRC.FACL_ONLOC_CHK_DGT , 
TGT.NUM_PASSENGERS = CAST (SRC.NUM_PASSENGERS AS INT64) , 
TGT.CALL_TYPE = SRC.CALL_TYPE , 
TGT.RV_CLASS = SRC.RV_CLASS , 
TGT.MCYCLE_INDIC = SRC.MCYCLE_INDIC , 
TGT.SVC_FACL_ID = SRC.SVC_FACL_ID , 
TGT.SVC_TICK_APPROVD = SRC.SVC_TICK_APPROVD , 
TGT.ACCOUNTING_DATETIME = SRC.ACCOUNTING_DATE , 
TGT.RESPONSE_INDIC = SRC.RESPONSE_INDIC , 
TGT.AUTH_CD = SRC.AUTH_CD , 
TGT.AUTH_LEVEL = SRC.AUTH_LEVEL , 
TGT.EMAIL_ADDR = SRC.EMAIL_ADDR , 
TGT.BL_TEL_TYP_CD = SRC.BL_TEL_TYP_CD , 
TGT.MILES_START_ORIG = CAST(SRC.MILES_START_ORIG AS FLOAT64) , 
TGT.MILES_ONLC_ORIG = CAST(SRC.MILES_ONLC_ORIG AS FLOAT64) , 
TGT.MILES_DEST_ORIG = CAST(SRC.MILES_DEST_ORIG AS FLOAT64), 
TGT.AUDIT_FLAG = SRC.AUDIT_FLAG , 
TGT.BATT_SVC_RESULT = SRC.BATT_SVC_RESULT , 
TGT.BATTERY_TESTED = SRC.BATTERY_TESTED , 
TGT.BATTERY_TESTNUMBER = SRC.BATTERY_TESTNUMBER , 
TGT.MBR_REQ_EMAIL = SRC.MBR_REQ_EMAIL , 
TGT.AUDITOR = SRC.AUDITOR , 
TGT.CC_INFO_FLG = SRC.CC_INFO_FLG , 
TGT.CC_RCPT_FLG = SRC.CC_RCPT_FLG , 
TGT.CC_CHRG_FLG = SRC.CC_CHRG_FLG , 
TGT.CC_AMT = CAST(SRC.CC_AMT AS FLOAT64), 
TGT.USED_LONG_TOW = SRC.USED_LONG_TOW , 
TGT.LONG_TOW_ELIG_INDIC = SRC.LONG_TOW_ELIG_INDIC , 
TGT.LONG_TOW_MILES_ALLOW = SRC.LONG_TOW_MILES_ALLOW , 
TGT.BL_N_LNDMRK_TX = SRC.BL_N_LNDMRK_TX , 
TGT.LANGUAGE = SRC.LANGUAGE , 
TGT.COLLISION_FLAG = SRC.COLLISION_FLAG , 
TGT.BATTERY_TEST_RESULTS = SRC.BATTERY_TEST_RESULTS , 
TGT.BATTERY_PART_NUMBER = SRC.BATTERY_PART_NUMBER , 
TGT.BATTERY_PRICE = CAST(SRC.BATTERY_PRICE AS FLOAT64) , 
TGT.CALLMV_INDIC = SRC.CALLMV_INDIC , 
TGT.VEHICLE_ID = SRC.VEHICLE_ID , 
TGT.CC_CHRG_REVOK_FLG = SRC.CC_CHRG_REVOK_FLG , 
TGT.BASE_VEHICLE_ID = SRC.BASE_VEHICLE_ID , 
TGT.AVL_ETA = CAST(SRC.AVL_ETA AS INT64) , 
TGT.SMS_OPT_IN = SRC.SMS_OPT_IN , 
TGT.BLEND_RATE_INDIC = SRC.BLEND_RATE_INDIC , 
TGT.DTL_PROB1_CD_ORIG = SRC.DTL_PROB1_CD_ORIG , 
TGT.DTL_PROB2_CD_ORIG = SRC.DTL_PROB2_CD_ORIG , 
TGT.WORKFLOW = SRC.WORKFLOW , 
TGT.TWO_WHEEL_DRIVE = SRC.TWO_WHEEL_DRIVE , 
TGT.DOLLY_INDIC = SRC.DOLLY_INDIC , 
TGT.LOCKSMITH_INDIC = SRC.LOCKSMITH_INDIC , 
TGT.WHEEL_LIFT_REQ_INDIC = SRC.WHEEL_LIFT_REQ_INDIC , 
TGT.WHEEL_LIFT_INDIC = SRC.WHEEL_LIFT_INDIC , 
TGT.MC_TYPE = SRC.MC_TYPE , 
TGT.MC_ENG_TYPE = SRC.MC_ENG_TYPE , 
TGT.MC_COMMENT = SRC.MC_COMMENT , 
TGT.MC_PULLING_TRL = SRC.MC_PULLING_TRL , 
TGT.MC_LAID_DOWN = SRC.MC_LAID_DOWN , 
TGT.MC_WHEELS_ROLL = SRC.MC_WHEELS_ROLL , 
TGT.RV_LENGTH = SRC.RV_LENGTH , 
TGT.RV_HEIGHT = SRC.RV_HEIGHT , 
TGT.RV_GOOSENECK = SRC.RV_GOOSENECK , 
TGT.RV_ENG_LOC = SRC.RV_ENG_LOC , 
TGT.RV_TOWING = SRC.RV_TOWING , 
TGT.RV_TYPE_TOWING = SRC.RV_TYPE_TOWING , 
TGT.FLAT_LOCATION = SRC.FLAT_LOCATION , 
TGT.TRL_INDIC = SRC.TRL_INDIC , 
TGT.TRL_TYPE = SRC.TRL_TYPE , 
TGT.TRL_LENGTH = SRC.TRL_LENGTH , 
TGT.TRL_NO_AXLES = SRC.TRL_NO_AXLES , 
TGT.TRL_CONDITION = SRC.TRL_CONDITION , 
TGT.TRL_PLUG_TYPE = SRC.TRL_PLUG_TYPE , 
TGT.TRL_HITCH_TYPE = SRC.TRL_HITCH_TYPE , 
TGT.TRL_HITCH_SIZE = SRC.TRL_HITCH_SIZE , 
TGT.TRL_GOOSENECK = SRC.TRL_GOOSENECK , 
TGT.TRL_LOADED = SRC.TRL_LOADED , 
TGT.TRL_LOAD_TYPE = SRC.TRL_LOAD_TYPE , 
TGT.TRL_LOAD_WEIGHT = SRC.TRL_LOAD_WEIGHT , 
TGT.HYBRID_VEHICLE = SRC.HYBRID_VEHICLE , 
TGT.ELECTRIC_VEHICLE = SRC.ELECTRIC_VEHICLE , 
TGT.IS_DIESEL = SRC.IS_DIESEL , 
TGT.AIR_SUSPENSION = SRC.AIR_SUSPENSION , 
TGT.SC_VEH_NOTES = SRC.SC_VEH_NOTES , 
TGT.RV_WEIGHT = SRC.RV_WEIGHT , 
TGT.PASSENGER_NOTES = SRC.PASSENGER_NOTES , 
TGT.PRIORITY_COMMENT = SRC.PRIORITY_COMMENT , 
TGT.KEY_LOCATION = SRC.KEY_LOCATION , 
TGT.SCRATCHPAD_CONTENT = SRC.SCRATCHPAD_CONTENT , 
TGT.D3_CALLBACK_STATE = SRC.D3_CALLBACK_STATE , 
TGT.ADDR2_PURPOSE = SRC.ADDR2_PURPOSE , 
TGT.ADDR2_BLOCK = SRC.ADDR2_BLOCK , 
TGT.ADDR2_STREET = SRC.ADDR2_STREET , 
TGT.ADDR2_CITY = SRC.ADDR2_CITY , 
TGT.ADDR2_STATE_CD = SRC.ADDR2_STATE_CD , 
TGT.ADDR2_ZIP = SRC.ADDR2_ZIP , 
TGT.ADDR2_ZIP4 = SRC.ADDR2_ZIP4 , 
TGT.ADDR2_COUNTY = SRC.ADDR2_COUNTY , 
TGT.ADDR2_COUNTRY = SRC.ADDR2_COUNTRY , 
TGT.ADDR2_HIGHWAY_CALL = SRC.ADDR2_HIGHWAY_CALL , 
TGT.ADDR2_MILE_MARKER = CAST(SRC.ADDR2_MILE_MARKER AS INT64),
TGT.ADDR2_CALLBOX = SRC.ADDR2_CALLBOX , 
TGT.ADDR2_LOCATION_CD = SRC.ADDR2_LOCATION_CD , 
TGT.ADDR2_LANDMARK = SRC.ADDR2_LANDMARK , 
TGT.ADDR2_PICKUP_POINT = SRC.ADDR2_PICKUP_POINT , 
TGT.SC_VEH_TRM = SRC.SC_VEH_TRM , 
TGT.SPECIAL_EQUIP_CD = SRC.SPECIAL_EQUIP_CD , 
TGT.DELIVERY_CONFIRMATION_CODE = SRC.DELIVERY_CONFIRMATION_CODE , 
TGT.SALE_ID = SRC.SALE_ID , 
TGT.ODOMETER_READING = CAST(SRC.ODOMETER_READING AS INT64) , 
TGT.MISCELLANEOUS_COMMENT = SRC.MISCELLANEOUS_COMMENT , 
TGT.INVENTORY_MISSING = SRC.INVENTORY_MISSING , 
TGT.TOW_INDIC = SRC.TOW_INDIC , 
TGT.URGENT_COMMENT_INDIC = SRC.URGENT_COMMENT_INDIC , 
TGT.ETL_JOB_RUN_ID = CAST (SRC.JOB_RUN_ID AS INT64) , 
TGT.SOURCE_SYSTEM_CD = SRC.SOURCE_SYSTEM_CD ,  
TGT.CREATE_DTTIME = current_datetime() ,
TGT.CREATE_BY = SRC.CREATED_BY ,
TGT.LAST_UPDATE_DTTIME = current_datetime() ,
TGT.LAST_UPDATE_BY = "Last updated by"

WHEN NOT MATCHED THEN INSERT 
(
COMM_CTR_ID , 
SC_DT , 
SC_ID , 
EDS_INDIC , 
SCOC_INDIC , 
CUC_INDIC , 
FLATBED_REQ_INDIC , 
USE_THIS_FACL , 
NOT_THIS_FACL , 
BILL_CODE , 
APT_CALL_INDIC , 
TRK_ZONE , 
BL_LAT , 
BL_LONG , 
TD_LAT , 
TD_LONG , 
DRIVER_NAME , 
TOW_DEST_ID , 
FLATBED_INDIC , 
FOUR_WHEEL_DRIVE , 
REC_VEHICLE , 
AWD_VEHICLE , 
CASH_CALL_TYPE , 
PO_TRACKING_NUMBER , 
CC_NUMBER , 
CC_EXPIRE_DATETIME , 
DISTRICT_NUM , 
FACL_ONLOC_CHK_DGT , 
NUM_PASSENGERS , 
CALL_TYPE , 
RV_CLASS , 
MCYCLE_INDIC , 
SVC_FACL_ID , 
SVC_TICK_APPROVD , 
ACCOUNTING_DATETIME , 
RESPONSE_INDIC , 
AUTH_CD , 
AUTH_LEVEL , 
EMAIL_ADDR , 
BL_TEL_TYP_CD , 
MILES_START_ORIG , 
MILES_ONLC_ORIG , 
MILES_DEST_ORIG , 
AUDIT_FLAG , 
BATT_SVC_RESULT , 
BATTERY_TESTED , 
BATTERY_TESTNUMBER , 
MBR_REQ_EMAIL , 
AUDITOR , 
CC_INFO_FLG , 
CC_RCPT_FLG , 
CC_CHRG_FLG , 
CC_AMT , 
USED_LONG_TOW , 
LONG_TOW_ELIG_INDIC , 
LONG_TOW_MILES_ALLOW , 
BL_N_LNDMRK_TX , 
LANGUAGE , 
COLLISION_FLAG , 
BATTERY_TEST_RESULTS , 
BATTERY_PART_NUMBER , 
BATTERY_PRICE , 
CALLMV_INDIC , 
VEHICLE_ID , 
CC_CHRG_REVOK_FLG , 
BASE_VEHICLE_ID , 
AVL_ETA , 
SMS_OPT_IN , 
BLEND_RATE_INDIC , 
DTL_PROB1_CD_ORIG , 
DTL_PROB2_CD_ORIG , 
WORKFLOW , 
TWO_WHEEL_DRIVE , 
DOLLY_INDIC , 
LOCKSMITH_INDIC , 
WHEEL_LIFT_REQ_INDIC , 
WHEEL_LIFT_INDIC , 
MC_TYPE , 
MC_ENG_TYPE , 
MC_COMMENT , 
MC_PULLING_TRL , 
MC_LAID_DOWN , 
MC_WHEELS_ROLL , 
RV_LENGTH , 
RV_HEIGHT , 
RV_GOOSENECK , 
RV_ENG_LOC , 
RV_TOWING , 
RV_TYPE_TOWING , 
FLAT_LOCATION , 
TRL_INDIC , 
TRL_TYPE , 
TRL_LENGTH , 
TRL_NO_AXLES , 
TRL_CONDITION , 
TRL_PLUG_TYPE , 
TRL_HITCH_TYPE , 
TRL_HITCH_SIZE , 
TRL_GOOSENECK , 
TRL_LOADED , 
TRL_LOAD_TYPE , 
TRL_LOAD_WEIGHT , 
HYBRID_VEHICLE , 
ELECTRIC_VEHICLE , 
IS_DIESEL , 
AIR_SUSPENSION , 
SC_VEH_NOTES , 
RV_WEIGHT , 
PASSENGER_NOTES , 
PRIORITY_COMMENT , 
KEY_LOCATION , 
SCRATCHPAD_CONTENT , 
D3_CALLBACK_STATE , 
ADDR2_PURPOSE , 
ADDR2_BLOCK , 
ADDR2_STREET , 
ADDR2_CITY , 
ADDR2_STATE_CD , 
ADDR2_ZIP , 
ADDR2_ZIP4 , 
ADDR2_COUNTY , 
ADDR2_COUNTRY , 
ADDR2_HIGHWAY_CALL , 
ADDR2_MILE_MARKER , 
ADDR2_CALLBOX , 
ADDR2_LOCATION_CD , 
ADDR2_LANDMARK , 
ADDR2_PICKUP_POINT , 
SC_VEH_TRM , 
SPECIAL_EQUIP_CD , 
DELIVERY_CONFIRMATION_CODE,
SALE_ID,
ODOMETER_READING,
MISCELLANEOUS_COMMENT,
INVENTORY_MISSING,
TOW_INDIC,
URGENT_COMMENT_INDIC,
ETL_JOB_RUN_ID , 
SOURCE_SYSTEM_CD , 
CREATE_DTTIME , 
CREATE_BY , 
LAST_UPDATE_DTTIME , 
LAST_UPDATE_BY )

VALUES

(
SRC.COMM_CTR_ID ,
CAST(SRC.SC_DT AS DATETIME) ,
CAST(SRC.SC_ID AS INT64),
SRC.EDS_INDIC ,
SRC.SCOC_INDIC ,
SRC.CUC_INDIC ,
SRC.FLATBED_REQ_INDIC ,
SRC.USE_THIS_FACL ,
SRC.NOT_THIS_FACL ,
SRC.BILL_CODE ,
SRC.APT_CALL_INDIC ,
SRC.TRK_ZONE ,
CAST(SRC.BL_LAT AS FLOAT64) ,
CAST(SRC.BL_LONG AS FLOAT64),
CAST(SRC.TD_LAT AS FLOAT64),
CAST(SRC.TD_LONG AS FLOAT64) ,
SRC.DRIVER_NAME ,
CAST(SRC.TOW_DEST_ID AS INT64) ,
SRC.FLATBED_INDIC ,
SRC.FOUR_WHEEL_DRIVE ,
SRC.REC_VEHICLE ,
SRC.AWD_VEHICLE ,
SRC.CASH_CALL_TYPE ,
SRC.PO_TRACKING_NUMBER ,
SRC.CC_NUMBER ,
SRC.CC_EXPIRE_DATE ,
SRC.DISTRICT_NUM ,
SRC.FACL_ONLOC_CHK_DGT ,
CAST (SRC.NUM_PASSENGERS AS INT64) ,
SRC.CALL_TYPE ,
SRC.RV_CLASS ,
SRC.MCYCLE_INDIC ,
SRC.SVC_FACL_ID ,
SRC.SVC_TICK_APPROVD ,
SRC.ACCOUNTING_DATE ,
SRC.RESPONSE_INDIC ,
SRC.AUTH_CD ,
SRC.AUTH_LEVEL ,
SRC.EMAIL_ADDR ,
SRC.BL_TEL_TYP_CD ,
CAST(SRC.MILES_START_ORIG AS FLOAT64) ,
CAST(SRC.MILES_ONLC_ORIG AS FLOAT64),
CAST(SRC.MILES_DEST_ORIG AS FLOAT64),
SRC.AUDIT_FLAG ,
SRC.BATT_SVC_RESULT ,
SRC.BATTERY_TESTED ,
SRC.BATTERY_TESTNUMBER ,
SRC.MBR_REQ_EMAIL ,
SRC.AUDITOR ,
SRC.CC_INFO_FLG ,
SRC.CC_RCPT_FLG ,
SRC.CC_CHRG_FLG ,
CAST(SRC.CC_AMT AS FLOAT64),
SRC.USED_LONG_TOW ,
SRC.LONG_TOW_ELIG_INDIC ,
SRC.LONG_TOW_MILES_ALLOW ,
SRC.BL_N_LNDMRK_TX ,
SRC.LANGUAGE ,
SRC.COLLISION_FLAG ,
SRC.BATTERY_TEST_RESULTS ,
SRC.BATTERY_PART_NUMBER ,
CAST(SRC.BATTERY_PRICE AS FLOAT64) ,
SRC.CALLMV_INDIC ,
SRC.VEHICLE_ID ,
SRC.CC_CHRG_REVOK_FLG ,
SRC.BASE_VEHICLE_ID ,
CAST(SRC.AVL_ETA AS INT64) ,
SRC.SMS_OPT_IN ,
SRC.BLEND_RATE_INDIC ,
SRC.DTL_PROB1_CD_ORIG ,
SRC.DTL_PROB2_CD_ORIG ,
SRC.WORKFLOW ,
SRC.TWO_WHEEL_DRIVE ,
SRC.DOLLY_INDIC ,
SRC.LOCKSMITH_INDIC ,
SRC.WHEEL_LIFT_REQ_INDIC ,
SRC.WHEEL_LIFT_INDIC ,
SRC.MC_TYPE ,
SRC.MC_ENG_TYPE ,
SRC.MC_COMMENT ,
SRC.MC_PULLING_TRL ,
SRC.MC_LAID_DOWN ,
SRC.MC_WHEELS_ROLL ,
SRC.RV_LENGTH ,
SRC.RV_HEIGHT ,
SRC.RV_GOOSENECK ,
SRC.RV_ENG_LOC ,
SRC.RV_TOWING ,
SRC.RV_TYPE_TOWING ,
SRC.FLAT_LOCATION ,
SRC.TRL_INDIC ,
SRC.TRL_TYPE ,
SRC.TRL_LENGTH ,
SRC.TRL_NO_AXLES ,
SRC.TRL_CONDITION ,
SRC.TRL_PLUG_TYPE ,
SRC.TRL_HITCH_TYPE ,
SRC.TRL_HITCH_SIZE ,
SRC.TRL_GOOSENECK ,
SRC.TRL_LOADED ,
SRC.TRL_LOAD_TYPE ,
SRC.TRL_LOAD_WEIGHT ,
SRC.HYBRID_VEHICLE ,
SRC.ELECTRIC_VEHICLE ,
SRC.IS_DIESEL ,
SRC.AIR_SUSPENSION ,
SRC.SC_VEH_NOTES ,
SRC.RV_WEIGHT ,
SRC.PASSENGER_NOTES ,
SRC.PRIORITY_COMMENT ,
SRC.KEY_LOCATION ,
SRC.SCRATCHPAD_CONTENT ,
SRC.D3_CALLBACK_STATE ,
SRC.ADDR2_PURPOSE ,
SRC.ADDR2_BLOCK ,
SRC.ADDR2_STREET ,
SRC.ADDR2_CITY ,
SRC.ADDR2_STATE_CD ,
SRC.ADDR2_ZIP ,
SRC.ADDR2_ZIP4 ,
SRC.ADDR2_COUNTY ,
SRC.ADDR2_COUNTRY ,
SRC.ADDR2_HIGHWAY_CALL ,
CAST (SRC.ADDR2_MILE_MARKER AS INT64) ,
SRC.ADDR2_CALLBOX ,
SRC.ADDR2_LOCATION_CD ,
SRC.ADDR2_LANDMARK ,
SRC.ADDR2_PICKUP_POINT ,
SRC.SC_VEH_TRM ,
SRC.SPECIAL_EQUIP_CD ,
SRC.DELIVERY_CONFIRMATION_CODE,
SRC.SALE_ID,
CAST(SRC.ODOMETER_READING AS INT64),
SRC.MISCELLANEOUS_COMMENT,
SRC.INVENTORY_MISSING,
SRC.TOW_INDIC,
SRC.URGENT_COMMENT_INDIC,
CAST (SRC.JOB_RUN_ID AS INT64) ,
SRC.SOURCE_SYSTEM_CD , 
current_datetime(),
SRC.CREATED_BY , 
current_datetime(),
"Last updated by"
)

