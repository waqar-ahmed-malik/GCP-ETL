MERGE
  `CUSTOMER_PRODUCT.ERS_CALL_VEHICLE_DIM` AS TGT
USING `LANDING.WORK_ERS_CALL_VEHICLE_DIM` AS SRC
ON TGT.CUSTOMER_MDM_KEY = SAFE_CAST(SRC.CUSTOMER_MDM_KEY AS INT64) AND 
TGT.MANUFACTURE_YEAR = SRC.MANUFACTURE_YEAR AND
TGT.MANUFACTURER = SRC.MANUFACTURER AND
TGT.MODEL = SRC.MODEL AND
TGT.COLOR = SRC.COLOR
WHEN MATCHED
THEN UPDATE SET
TGT.MEMBER_NUM = SRC.MEMBER_NUM,
TGT.COMM_CTR_ID = SRC.COMM_CTR_ID,
TGT.SC_DT = PARSE_DATE("%Y-%m-%d",SRC.SC_DT),
TGT.SC_ID = SAFE_CAST(SRC.SC_ID AS INT64),
TGT.CLUB_CD = SRC.CLUB_CD,
TGT.LICENSE_STATE_CD = SRC.LICENSE_STATE_CD,
TGT.LICENSE_TAG_NUM = SRC.LICENSE_TAG_NUM,
TGT.VEHICLE_RECORD_CHANGE_IND = SRC.VEHICLE_RECORD_CHANGE_IND,
TGT.FLATBED_IND = SRC.FLATBED_IND,
TGT.FOUR_WHEEL_DRIVE = SRC.FOUR_WHEEL_DRIVE,
TGT.REC_VEHICLE = SRC.REC_VEHICLE,
TGT.AWD_VEHICLE = SRC.AWD_VEHICLE,
TGT.MOTOR_CYCLE_IND = SRC.MOTOR_CYCLE_IND,
TGT.VEHICLE_ID = SRC.VEHICLE_ID,
TGT.BASE_VEHICLE_ID = SRC.BASE_VEHICLE_ID,
TGT.VEHICLE_TYPE = SRC.VEHICLE_TYPE,
TGT.TWO_WHEEL_DRIVE = SRC.TWO_WHEEL_DRIVE,
TGT.VEHICLE_TERM = SRC.VEHICLE_TERM,
TGT.ARCH_DTTIME = PARSE_DATETIME("%Y-%m-%d %H:%M:%S",SRC.ARCH_DTTIME),
TGT.LAST_UPDATE_DTTIME = CURRENT_DATETIME()

WHEN NOT MATCHED THEN INSERT
(CUSTOMER_MDM_KEY,
MEMBER_NUM,
COMM_CTR_ID,
SC_DT,
SC_ID,
CLUB_CD,
LICENSE_STATE_CD,
LICENSE_TAG_NUM,
MANUFACTURE_YEAR,
MANUFACTURER,
MODEL,
COLOR,
VEHICLE_RECORD_CHANGE_IND,
FLATBED_IND,
FOUR_WHEEL_DRIVE,
REC_VEHICLE,
AWD_VEHICLE,
MOTOR_CYCLE_IND,
VEHICLE_ID,
BASE_VEHICLE_ID,
VEHICLE_TYPE,
TWO_WHEEL_DRIVE,
VEHICLE_TERM,
ARCH_DTTIME,
LAST_UPDATE_DTTIME,
CREATED_DTTIME,
JOB_RUN_ID,
SOURCE_SYSTEM_CD)
VALUES
(SAFE_CAST(SRC.CUSTOMER_MDM_KEY AS INT64),
SRC.MEMBER_NUM,
SRC.COMM_CTR_ID,
PARSE_DATE("%Y-%m-%d",SRC.SC_DT),
SAFE_CAST(SRC.SC_ID AS INT64),
SRC.CLUB_CD,
SRC.LICENSE_STATE_CD,
SRC.LICENSE_TAG_NUM,
SRC.MANUFACTURE_YEAR,
SRC.MANUFACTURER,
SRC.MODEL,
SRC.COLOR,
SRC.VEHICLE_RECORD_CHANGE_IND,
SRC.FLATBED_IND,
SRC.FOUR_WHEEL_DRIVE,
SRC.REC_VEHICLE,
SRC.AWD_VEHICLE,
SRC.MOTOR_CYCLE_IND,
SRC.VEHICLE_ID,
SRC.BASE_VEHICLE_ID,
SRC.VEHICLE_TYPE,
SRC.TWO_WHEEL_DRIVE,
SRC.VEHICLE_TERM,
PARSE_DATETIME("%Y-%m-%d %H:%M:%S",SRC.ARCH_DTTIME),
CURRENT_DATETIME(),
CURRENT_DATETIME(),
'jobrunid',
'ERS'
)